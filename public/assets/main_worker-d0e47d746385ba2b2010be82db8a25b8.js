AsciiIo={},console={log:function(e){postMessage({message:"log",text:e})}},function(){function e(t,n,r){if(t===n)return t!==0||1/t==1/n;if(t==null||n==null)return t===n;t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped);if(t.isEqual&&E.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&E.isFunction(n.isEqual))return n.isEqual(t);var i=a.call(t);if(i!=a.call(n))return!1;switch(i){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:t==0?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if(typeof t!="object"||typeof n!="object")return!1;for(var s=r.length;s--;)if(r[s]==t)return!0;r.push(t);var s=0,o=!0;if(i=="[object Array]"){if(s=t.length,o=s==n.length)for(;s--;)if(!(o=s in t==s in n&&e(t[s],n[s],r)))break}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var u in t)if(E.has(t,u)&&(s++,!(o=E.has(n,u)&&e(t[u],n[u],r))))break;if(o){for(u in n)if(E.has(n,u)&&!(s--))break;o=!s}}return r.pop(),o}var t=this,n=t._,r={},i=Array.prototype,s=Object.prototype,o=i.slice,u=i.unshift,a=s.toString,f=s.hasOwnProperty,l=i.forEach,c=i.map,h=i.reduce,p=i.reduceRight,d=i.filter,v=i.every,m=i.some,g=i.indexOf,y=i.lastIndexOf,s=Array.isArray,b=Object.keys,w=Function.prototype.bind,E=function(e){return new L(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.3.1";var S=E.each=E.forEach=function(e,t,n){if(e!=null)if(l&&e.forEach===l)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(n,e[i],i,e)===r)break}else for(i in e)if(E.has(e,i)&&t.call(n,e[i],i,e)===r)break};E.map=E.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(S(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);S(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},E.reduceRight=E.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=E.toArray(e).reverse();return r&&!i&&(t=E.bind(t,r)),i?E.reduce(s,t,n,r):E.reduce(s,t)},E.find=E.detect=function(e,t,n){var r;return x(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},E.filter=E.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(S(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},E.reject=function(e,t,n){var r=[];return e==null?r:(S(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},E.every=E.all=function(e,t,n){var i=!0;return e==null?i:v&&e.every===v?e.every(t,n):(S(e,function(e,s,o){if(!(i=i&&t.call(n,e,s,o)))return r}),i)};var x=E.some=E.any=function(e,t,n){t||(t=E.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,n):(S(e,function(e,s,o){if(i||(i=t.call(n,e,s,o)))return r}),!!i)};E.include=E.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:n=x(e,function(e){return e===t})},E.invoke=function(e,t){var n=o.call(arguments,2);return E.map(e,function(e){return(E.isFunction(t)?t||e:e[t]).apply(e,n)})},E.pluck=function(e,t){return E.map(e,function(e){return e[t]})},E.max=function(e,t,n){if(!t&&E.isArray(e))return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-Infinity;var r={computed:-Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i>=r.computed&&(r={value:e,computed:i})}),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e))return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return Infinity;var r={computed:Infinity};return S(e,function(e,i,s){i=t?t.call(n,e,i,s):e,i<r.computed&&(r={value:e,computed:i})}),r.value},E.shuffle=function(e){var t=[],n;return S(e,function(e,r){r==0?t[0]=e:(n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e)}),t},E.sortBy=function(e,t,n){return E.pluck(E.map(e,function(e,r,i){return{value:e,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0}),"value")},E.groupBy=function(e,t){var n={},r=E.isFunction(t)?t:function(e){return e[t]};return S(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},E.sortedIndex=function(e,t,n){n||(n=E.identity);for(var r=0,i=e.length;r<i;){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},E.toArray=function(e){return e?e.toArray?e.toArray():E.isArray(e)?o.call(e):E.isArguments(e)?o.call(e):E.values(e):[]},E.size=function(e){return E.toArray(e).length},E.first=E.head=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},E.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},E.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},E.rest=E.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},E.compact=function(e){return E.filter(e,function(e){return!!e})},E.flatten=function(e,t){return E.reduce(e,function(e,n){return E.isArray(n)?e.concat(t?n:E.flatten(n)):(e[e.length]=n,e)},[])},E.without=function(e){return E.difference(e,o.call(arguments,1))},E.uniq=E.unique=function(e,t,n){var n=n?E.map(e,n):e,r=[];return E.reduce(n,function(n,i,s){if(0==s||(t===!0?E.last(n)!=i:!E.include(n,i)))n[n.length]=i,r[r.length]=e[s];return n},[]),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=E.intersect=function(e){var t=o.call(arguments,1);return E.filter(E.uniq(e),function(e){return E.every(t,function(t){return E.indexOf(t,e)>=0})})},E.difference=function(e){var t=E.flatten(o.call(arguments,1));return E.filter(e,function(e){return!E.include(t,e)})},E.zip=function(){for(var e=o.call(arguments),t=E.max(E.pluck(e,"length")),n=Array(t),r=0;r<t;r++)n[r]=E.pluck(e,""+r);return n},E.indexOf=function(e,t,n){if(e==null)return-1;var r;if(n)return n=E.sortedIndex(e,t),e[n]===t?n:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(n=0,r=e.length;n<r;n++)if(n in e&&e[n]===t)return n;return-1},E.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},E.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);i<r;)s[i++]=e,e+=n;return s};var T=function(){};E.bind=function(e,t){var n,r;if(e.bind===w&&w)return w.apply(e,o.call(arguments,1));if(!E.isFunction(e))throw new TypeError;return r=o.call(arguments,2),n=function(){if(this instanceof n){T.prototype=e.prototype;var i=new T,s=e.apply(i,r.concat(o.call(arguments)));return Object(s)===s?s:i}return e.apply(t,r.concat(o.call(arguments)))}},E.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=E.functions(e)),S(t,function(t){e[t]=E.bind(e[t],e)}),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(e,n)},t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(o.call(arguments,1)))},E.throttle=function(e,t){var n,r,i,s,o,u=E.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var a;i||(i=setTimeout(function(){i=null,o&&e.apply(n,r),u()},t)),s?o=!0:e.apply(n,r),u(),s=!0}},E.debounce=function(e,t){var n;return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout(function(){n=null,e.apply(r,i)},t)}},E.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},E.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},E.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[],n;for(n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){return E.map(e,E.identity)},E.functions=E.methods=function(e){var t=[],n;for(n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},E.defaults=function(e){return S(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e},E.isEqual=function(t,n){return e(t,n,[])},E.isEmpty=function(e){if(E.isArray(e)||E.isString(e))return e.length===0;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!!e&&e.nodeType==1},E.isArray=s||function(e){return a.call(e)=="[object Array]"},E.isObject=function(e){return e===Object(e)},E.isArguments=function(e){return a.call(e)=="[object Arguments]"},E.isArguments(arguments)||(E.isArguments=function(e){return!!e&&!!E.has(e,"callee")}),E.isFunction=function(e){return a.call(e)=="[object Function]"},E.isString=function(e){return a.call(e)=="[object String]"},E.isNumber=function(e){return a.call(e)=="[object Number]"},E.isNaN=function(e){return e!==e},E.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},E.isDate=function(e){return a.call(e)=="[object Date]"},E.isRegExp=function(e){return a.call(e)=="[object RegExp]"},E.isNull=function(e){return e===null},E.isUndefined=function(e){return e===void 0},E.has=function(e,t){return f.call(e,t)},E.noConflict=function(){return t._=n,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},E.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},E.mixin=function(e){S(E.functions(e),function(t){O(t,E[t]=e[t])})};var N=0;E.uniqueId=function(e){var t=N++;return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,k=function(e){return e.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};E.template=function(e,t){var n=E.templateSettings,n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.escape||C,function(e,t){return"',_.escape("+k(t)+"),'"}).replace(n.interpolate||C,function(e,t){return"',"+k(t)+",'"}).replace(n.evaluate||C,function(e,t){return"');"+k(t).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",r=new Function("obj","_",n);return t?r(t,E):function(e){return r.call(this,e,E)}},E.chain=function(e){return E(e).chain()};var L=function(e){this._wrapped=e};E.prototype=L.prototype;var A=function(e,t){return t?E(e).chain():e},O=function(e,t){L.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),A(t.apply(E,e),this._chain)}};E.mixin(E),S("pop,push,reverse,shift,sort,splice,unshift".split(","),function(e){var t=i[e];L.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],A(n,this._chain)}}),S(["concat","join","slice"],function(e){var t=i[e];L.prototype[e]=function(){return A(t.apply(this._wrapped,arguments),this._chain)}}),L.prototype.chain=function(){return this._chain=!0,this},L.prototype.value=function(){return this._wrapped}}.call(this),function(){var e=this,t=e.Backbone,n=Array.prototype.slice,r=Array.prototype.splice,i;i="undefined"!=typeof exports?exports:e.Backbone={},i.VERSION="0.9.1";var s=e._;!s&&"undefined"!=typeof require&&(s=require("underscore"));var o=e.jQuery||e.Zepto||e.ender;i.setDomLibrary=function(e){o=e},i.noConflict=function(){return e.Backbone=t,this},i.emulateHTTP=!1,i.emulateJSON=!1,i.Events={on:function(e,t,n){for(var r,e=e.split(/\s+/),i=this._callbacks||(this._callbacks={});r=e.shift();){r=i[r]||(i[r]={});var s=r.tail||(r.tail=r.next={});s.callback=t,s.context=n,r.tail=s.next={}}return this},off:function(e,t,n){var r,i,s;if(e){if(i=this._callbacks)for(e=e.split(/\s+/);r=e.shift();)if(s=i[r],delete i[r],t&&s)for(;(s=s.next)&&s.next;)(s.callback!==t||!!n&&s.context!==n)&&this.on(r,s.callback,s.context)}else delete this._callbacks;return this},trigger:function(e){var t,r,i,s;if(!(i=this._callbacks))return this;s=i.all;for((e=e.split(/\s+/)).push(null);t=e.shift();)s&&e.push({next:s.next,tail:s.tail,event:t}),(r=i[t])&&e.push({next:r.next,tail:r.tail});for(s=n.call(arguments,1);r=e.pop();){t=r.tail;for(i=r.event?[r.event].concat(s):s;(r=r.next)!==t;)r.callback.apply(r.context||this,i)}return this}},i.Events.bind=i.Events.on,i.Events.unbind=i.Events.off,i.Model=function(e,t){var n;e||(e={}),t&&t.parse&&(e=this.parse(e));if(n=y(this,"defaults"))e=s.extend({},n,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=s.uniqueId("c");if(!this.set(e,{silent:!0}))throw Error("Can't create an invalid model");delete this._changed,this._previousAttributes=s.clone(this.attributes),this.initialize.apply(this,arguments)},s.extend(i.Model.prototype,i.Events,{idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;return(t=this._escapedAttributes[e])?t:(t=this.attributes[e],this._escapedAttributes[e]=s.escape(null==t?"":""+t))},has:function(e){return null!=this.attributes[e]},set:function(e,t,n){var r,o;s.isObject(e)||null==e?(r=e,n=t):(r={},r[e]=t),n||(n={});if(!r)return this;r instanceof i.Model&&(r=r.attributes);if(n.unset)for(o in r)r[o]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var t=this.attributes,u=this._escapedAttributes,a=this._previousAttributes||{},f=this._setting;this._changed||(this._changed={}),this._setting=!0;for(o in r)if(e=r[o],s.isEqual(t[o],e)||delete u[o],n.unset?delete t[o]:t[o]=e,this._changing&&!s.isEqual(this._changed[o],e)&&(this.trigger("change:"+o,this,e,n),this._moreChanges=!0),delete this._changed[o],!s.isEqual(a[o],e)||s.has(t,o)!=s.has(a,o))this._changed[o]=e;return f||(!n.silent&&this.hasChanged()&&this.change(n),this._setting=!1),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(s.clone(this.attributes),e)},fetch:function(e){var e=e?s.clone(e):{},t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},save:function(e,t,n){var r,o;s.isObject(e)||null==e?(r=e,n=t):(r={},r[e]=t),n=n?s.clone(n):{},n.wait&&(o=s.clone(this.attributes)),e=s.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?e:n))return!1;var u=this,a=n.success;return n.success=function(e,t,i){t=u.parse(e,i),n.wait&&(t=s.extend(r||{},t));if(!u.set(t,n))return!1;a?a(u,e):u.trigger("sync",u,e,n)},n.error=i.wrapError(n.error,u,n),t=this.isNew()?"create":"update",t=(this.sync||i.sync).call(this,t,this,n),n.wait&&this.set(o,e),t},destroy:function(e){var e=e?s.clone(e):{},t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(this.isNew())return r();e.success=function(i){e.wait&&r(),n?n(t,i):t.trigger("sync",t,i,e)},e.error=i.wrapError(e.error,t,e);var o=(this.sync||i.sync).call(this,"delete",this,e);return e.wait||r(),o},url:function(){var e=y(this.collection,"url")||y(this,"urlRoot")||b();return this.isNew()?e:e+("/"==e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(e){if(this._changing||!this.hasChanged())return this;this._moreChanges=this._changing=!0;for(var t in this._changed)this.trigger("change:"+t,this,this._changed[t],e);for(;this._moreChanges;)this._moreChanges=!1,this.trigger("change",this,e);return this._previousAttributes=s.clone(this.attributes),delete this._changed,this._changing=!1,this},hasChanged:function(e){return arguments.length?this._changed&&s.has(this._changed,e):!s.isEmpty(this._changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this._changed):!1;var t,n=!1,r=this._previousAttributes,i;for(i in e)s.isEqual(r[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return s.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;var e=s.extend({},this.attributes,e),n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}}),i.Collection=function(e,t){t||(t={}),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})},s.extend(i.Collection.prototype,i.Events,{model:i.Model,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},add:function(e,t){var n,i,o,u,a,f={},l={};t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,i=e.length;n<i;n++){if(!(o=e[n]=this._prepareModel(e[n],t)))throw Error("Can't add an invalid model to a collection");if(f[u=o.cid]||this._byCid[u]||null!=(a=o.id)&&(l[a]||this._byId[a]))throw Error("Can't add the same model to a collection twice");f[u]=l[a]=o}for(n=0;n<i;n++)(o=e[n]).on("all",this._onModelEvent,this),this._byCid[o.cid]=o,null!=o.id&&(this._byId[o.id]=o);this.length+=i,r.apply(this.models,[null!=t.at?t.at:this.models.length,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(n=0,i=this.models.length;n<i;n++)f[(o=this.models[n]).cid]&&(t.index=n,o.trigger("add",o,this,t));return this},remove:function(e,t){var n,r,i,o;t||(t={}),e=s.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++)if(o=this.getByCid(e[n])||this.get(e[n]))delete this._byId[o.id],delete this._byCid[o.cid],i=this.indexOf(o),this.models.splice(i,1),this.length--,t.silent||(t.index=i,o.trigger("remove",o,this,t)),this._removeReference(o);return this},get:function(e){return null==e?null:this._byId[null!=e.id?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},sort:function(e){e||(e={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");var t=s.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return s.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,{silent:!0,parse:t.parse}),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e),n&&n(t,r)},e.error=i.wrapError(e.error,t,e),(this.sync||i.sync).call(this,"read",this,e)},create:function(e,t){var n=this,t=t?s.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(i,s){t.wait&&n.add(i,t),r?r(i,s):i.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e){return e},chain:function(){return s(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){return e instanceof i.Model?e.collection||(e.collection=this):(t.collection=this,e=new this.model(e,t),e._validate(e.attributes,t)||(e=!1)),e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"==e||"remove"==e)&&n!=this||("destroy"==e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments))}}),s.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(e){i.Collection.prototype[e]=function(){return s[e].apply(s,[this.models].concat(s.toArray(arguments)))}}),i.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var u=/:\w+/g,a=/\*\w+/g,f=/[-[\]{}()+?.,\\^$|#\s]/g;s.extend(i.Router.prototype,i.Events,{initialize:function(){},route:function(e,t,n){return i.history||(i.history=new i.History),s.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),i.history.route(e,s.bind(function(r){r=this._extractParameters(e,r),n&&n.apply(this,r),this.trigger.apply(this,["route:"+t].concat(r)),i.history.trigger("route",this,t,r)},this)),this},navigate:function(e,t){i.history.navigate(e,t)},_bindRoutes:function(){if(this.routes){var e=[],t;for(t in this.routes)e.unshift([t,this.routes[t]]);t=0;for(var n=e.length;t<n;t++)this.route(e[t][0],e[t][1],this[e[t][1]])}},_routeToRegExp:function(e){return e=e.replace(f,"\\$&").replace(u,"([^/]+)").replace(a,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}}),i.History=function(){this.handlers=[],s.bindAll(this,"checkUrl")};var l=/^[#\/]/,c=/msie [\w.]+/,h=!1;s.extend(i.History.prototype,i.Events,{interval:50,getFragment:function(e,t){if(null==e)if(this._hasPushState||t){var e=window.location.pathname,n=window.location.search;n&&(e+=n)}else e=window.location.hash;return e=decodeURIComponent(e),e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(l,"")},start:function(e){if(h)throw Error("Backbone.history has already been started");this.options=s.extend({},{root:"/"},this.options,e),this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var e=this.getFragment(),t=document.documentMode;if(t=c.exec(navigator.userAgent.toLowerCase())&&(!t||7>=t))this.iframe=o('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e);this._hasPushState?o(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!t?o(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,h=!0,e=window.location,t=e.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!t)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&t&&e.hash&&(this.fragment=e.hash.replace(l,""),window.history.replaceState({},document.title,e.protocol+"//"+e.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){o(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),h=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();e==this.fragment&&this.iframe&&(e=this.getFragment(this.iframe.location.hash));if(e==this.fragment||e==decodeURIComponent(this.fragment))return!1;this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return s.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!h)return!1;if(!t||!0===t)t={trigger:t};var n=(e||"").replace(l,"");this.fragment==n||this.fragment==decodeURIComponent(n)||(this._hasPushState?(0!=n.indexOf(this.options.root)&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.iframe.location.hash)&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e))},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}}),i.View=function(e){this.cid=s.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var p=/^(\S+)\s*(.*)$/,d="model,collection,el,id,attributes,className,tagName".split(",");s.extend(i.View.prototype,i.Events,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){return e=document.createElement(e),t&&o(e).attr(t),n&&o(e).html(n),e},setElement:function(e,t){return this.$el=o(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=y(this,"events"))){this.undelegateEvents();for(var t in e){var n=e[t];s.isFunction(n)||(n=this[e[t]]);if(!n)throw Error('Event "'+e[t]+'" does not exist');var r=t.match(p),i=r[1],r=r[2],n=s.bind(n,this),i=i+(".delegateEvents"+this.cid);""===r?this.$el.bind(i,n):this.$el.delegate(r,i,n)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=s.extend({},this.options,e));for(var t=0,n=d.length;t<n;t++){var r=d[t];e[r]&&(this[r]=e[r])}this.options=e},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var e=y(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}}}),i.Model.extend=i.Collection.extend=i.Router.extend=i.View.extend=function(e,t){var n=g(this,e,t);return n.extend=this.extend,n};var v={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};i.sync=function(e,t,n){var r=v[e],u={type:r,dataType:"json"};return n.url||(u.url=y(t,"url")||b()),!n.data&&t&&("create"==e||"update"==e)&&(u.contentType="application/json",u.data=JSON.stringify(t.toJSON())),i.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),i.emulateHTTP&&("PUT"===r||"DELETE"===r)&&(i.emulateJSON&&(u.data._method=r),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}),"GET"!==u.type&&!i.emulateJSON&&(u.processData=!1),o.ajax(s.extend(u,n))},i.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var m=function(){},g=function(e,t,n){var r;return r=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},s.extend(r,e),m.prototype=e.prototype,r.prototype=new m,t&&s.extend(r.prototype,t),n&&s.extend(r,n),r.prototype.constructor=r,r.__super__=e.prototype,r},y=function(e,t){return!e||!e[t]?null:s.isFunction(e[t])?e[t]():e[t]},b=function(){throw Error('A "url" property or function must be specified')}}.call(this);var Utf8={encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t},decode:function(e){var t="",n=0,r=c1=c2=0;while(n<e.length)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((r&31)<<6|c2&63),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63),n+=3);return t}};(function(){String.prototype.times=function(e){return Array.prototype.join.call({length:e+1},this)}}).call(this),function(){AsciiIo.Brush=function(){function e(e){var t,n;e==null&&(e={}),this.fg=void 0,this.bg=void 0,this.blink=!1,this.bright=!1,this.italic=!1,this.underline=!1,this.reverse=!1;for(t in e)n=e[t],this[t]=n}return e.default_fg=7,e.default_bg=0,e.cache={},e.clearCache=function(){return this.cache={}},e["default"]=function(){return this._default||(this._default=this.create())},e.hash=function(e){return""+e.fg+"_"+e.bg+"_"+e.blink+"_"+e.bright+"_"+e.italic+"_"+e.underline+"_"+e.reverse},e.create=function(e){var t,n;return e==null&&(e={}),n=this.hash(e),t=this.cache[n],t||(t=new AsciiIo.Brush(e),this.cache[n]=t),t},e.prototype.hash=function(){return AsciiIo.Brush.hash(this)},e.prototype.attributes=function(){return{fg:this.fg,bg:this.bg,blink:this.blink,bright:this.bright,italic:this.italic,underline:this.underline,reverse:this.reverse}},e.prototype.fgColor=function(){return this.reverse?this.calculateBgColor():this.calculateFgColor()},e.prototype.bgColor=function(){return this.reverse?this.calculateFgColor():this.calculateBgColor()},e.prototype.calculateFgColor=function(){var e;return e=this.fg,e===void 0&&(e=AsciiIo.Brush.default_fg),e<8&&this.bright&&(e+=8),e},e.prototype.calculateBgColor=function(){var e;return e=this.bg,e===void 0&&(e=AsciiIo.Brush.default_bg),e<8&&this.blink&&(e+=8),e},e.prototype.applyChanges=function(e){var t,n,r;n=this.attributes();for(t in e)r=e[t],n[t]=r;return AsciiIo.Brush.create(n)},e.prototype.hasDefaultFg=function(){return this.fgColor()===AsciiIo.Brush.default_fg},e.prototype.hasDefaultBg=function(){return this.bgColor()===AsciiIo.Brush.default_bg},e}()}.call(this),function(){AsciiIo.AnsiInterpreter=function(){function e(){this.sgrInterpreter=new AsciiIo.SgrInterpreter}return e.prototype.parse=function(e){var t;this.commands=[];while(e.length>0){t=this.handleData(e);if(t===0)break;e=e.slice(t)}return[this.commands,e]},e.prototype.cb=function(){return this.commands.push(arguments)},e.prototype.handleData=function(e){var t;return e.match(/^\x1b[\x00-\x1f]/)?(this.handleControlCharacter(e[1]),2):(t=e.match(/^(\x1b\x5d|\x9d).*?(\x1b\\|\x9c|\x07)/))?t[0].length:(t=e.match(/^(\x1b[PX_^]|[\x90\x98\x9e\x9f]).*?(\x1b\\|\x9c)/))?t[0].length:(t=e.match(/^(?:\x1b\x5b|\x9b)([\x30-\x3f]*?)[\x20-\x2f]*?[\x40-\x7e]/))?(this.handleControlSequence(t[0],t[1],t),t[0].length):(t=e.match(/^\x1b[\x20-\x2f]*?[\x30-\x3f]/))?(this.handlePrivateEscSeq(t[0]),t[0].length):(t=e.match(/^\x1b[\x20-\x2f]*?[\x40-\x5a\x5c\x5e-\x7e]/))?(this.handleStandardEscSeq(t[0]),t[0].length):e.match(/^\x1b\x7f/)?2:e.match(/^[\x00-\x1a\x1c-\x1f]/)?(this.handleControlCharacter(e[0]),1):(t=e.match(/^([\x20-\x7e]|[\xe2-\xe9]..|[\xc2-\xc5].|[\xa1-\xfe])+/))?(this.handlePrintableCharacters(t[0]),t[0].length):e[0]===""?1:e.match(/^[\x80-\x9f]/)?(this.handleControlCharacter(e[0]),1):e[0]===" "?(this.handlePrintableCharacters(" "),1):e[0]==="ÿ"?1:0},e.prototype.handleControlCharacter=function(e){var t;t=function(){switch(e){case"":return"bell";case"\b":return"backspace";case"	":return"goToNextHorizontalTabStop";case"\n":return"lineFeed";case"":return"verticalTab";case"\f":return"formFeed";case"\r":return"carriageReturn";case"":return"index";case"":return"newLine";case"":return"setHorizontalTabStop";case"":return"reverseIndex"}}();if(t)return this.cb(t)},e.prototype.handlePrintableCharacters=function(e){return this.cb("print",e)},e.prototype.handleStandardEscSeq=function(e){var t,n,r;r=e[e.length-1],n=e[e.length-2],t=function(){switch(r){case"A":if(n==="(")return"setUkCharset";break;case"B":if(n==="(")return"setUsCharset";break;case"D":return"index";case"E":return"newLine";case"H":return"setHorizontalTabStop";case"M":return"reverseIndex";case"c":return"resetTerminal"}}();if(t)return this.cb(t)},e.prototype.handlePrivateEscSeq=function(e){var t,n,r;r=e[e.length-1],n=e[e.length-2],t=function(){switch(r){case"0":if(n==="(")return"setSpecialCharset";break;case"7":return"saveTerminalState";case"8":return"restoreTerminalState"}}();if(t)return this.cb(t)},e.prototype.handleControlSequence=function(e,t,n){return t&&t.match(/^[\x3c-\x3f]/)?this.handlePrivateControlSequence(e,t):this.handleStandardControlSequence(e,t)},e.prototype.handleStandardControlSequence=function(e,t){var n,r,i,s;s=e[e.length-1],i=this.parseParams(t),r=i[0],n=i[1];switch(s){case"@":return this.cb("reserveCharacters",r);case"A":return r===void 0&&(r=1),this.cb("priorRow",r);case"B":return r===void 0&&(r=1),this.cb("nextRow",r);case"C":return r===void 0&&(r=1),this.cb("nextColumn",r);case"D":return r===void 0&&(r=1),this.cb("priorColumn",r);case"E":return this.cb("nextRowFirstColumn",r);case"F":return this.cb("priorRowFirstColumn",r);case"G":return r===void 0&&
(r=1),this.cb("goToColumn",r);case"H":return r===void 0&&(r=1),n===void 0&&(n=1),this.cb("goToRowAndColumn",r,n);case"I":return this.cb("goToNextHorizontalTabStop",r);case"J":return r===2?this.cb("eraseScreen"):r===1?this.cb("eraseFromScreenStart"):this.cb("eraseToScreenEnd");case"K":return r===2?this.cb("eraseRow"):r===1?this.cb("eraseFromRowStart"):this.cb("eraseToRowEnd");case"L":return this.cb("insertLines",r||1);case"M":return this.cb("deleteLines",r||1);case"P":return this.cb("deleteCharacters",r||1);case"S":return this.cb("scrollUp",r);case"T":return this.cb("scrollDown",r);case"X":return this.cb("eraseCharacters",r);case"Z":return this.cb("goToPriorHorizontalTabStop",r);case"b":return this.cb("repeatLastCharacter",r);case"d":return this.cb("goToRow",r);case"f":return this.cb("goToRowAndColumn",r,n);case"g":if(!r||r===0)return this.cb("clearHorizontalTabStop");if(r===3)return this.cb("clearAllHorizontalTabStops");break;case"l":return console.log("(TODO) reset: "+r);case"m":return this.handleSGR(i);case"n":return this.cb("reportRowAndColumn");case"r":return r===void 0&&(r=1),n===void 0&&(n=this.lines),this.cb("setScrollRegion",r,n)}},e.prototype.handlePrivateControlSequence=function(e,t){var n,r,i,s,o,u;n=e[e.length-1],i=this.parseParams(t),u=[];for(s=0,o=i.length;s<o;s++)r=i[s],r===25?n==="h"?u.push(this.cb("showCursor")):n==="l"?u.push(this.cb("hideCursor")):u.push(void 0):r===47?n==="h"?u.push(this.cb("switchToAlternateBuffer")):n==="l"?u.push(this.cb("switchToNormalBuffer")):u.push(void 0):r===1049?n==="h"?(this.cb("switchToAlternateBuffer"),u.push(this.cb("eraseScreen"))):n==="l"?(this.cb("eraseScreen"),u.push(this.cb("switchToNormalBuffer"))):u.push(void 0):u.push(void 0);return u},e.prototype.parseParams=function(e){var t;return e.length===0?t=[]:t=_(e.replace(/[^0-9;]/,"").split(";")).map(function(e){return e===""?void 0:parseInt(e,10)}),t},e.prototype.handleSGR=function(e){var t;return e.length===0&&(e=[0]),t=this.sgrInterpreter.parse(e),this.cb("updateBrush",t)},e.prototype.formattedData=function(e){var t,n,r;return n=e.slice(0,100),r=function(){var e,r,i;i=[];for(e=0,r=n.length;e<r;e++)t=n[e],i.push("0x"+t.charCodeAt(0).toString(16));return i}(),Utf8.decode(n)+" ("+r.join()+")"},e}()}.call(this),function(){AsciiIo.ScreenBuffer=function(){function e(e,t,n,r){this.cols=e,this.lines=t,this.scrollRegion=n,this.tabStops=r,this.lineData=[],this.dirtyLines={},this.cursorX=0,this.cursorY=0,this.setBrush(AsciiIo.Brush["default"]()),this.setCharset("us")}return e.prototype.topMargin=function(){return this.scrollRegion.getTop()},e.prototype.bottomMargin=function(){return this.scrollRegion.getBottom()},e.prototype.updateLine=function(e){return e==null&&(e=this.cursorY),this.dirtyLines[e]=!0},e.prototype.updateLines=function(e,t){var n,r;n=e,r=[];while(n<=t)this.updateLine(n),r.push(n++);return r},e.prototype.updateScreen=function(){var e,t,n,r;r=[];for(e=t=0,n=this.lines;0<=n?t<n:t>n;e=0<=n?++t:--t)r.push(this.updateLine(e));return r},e.prototype.changes=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d;t={},h=this.dirtyLines;for(f in h){l=h[f],o=this.lineData[f]||[],u=[],r=AsciiIo.Brush["default"](),i="";for(a=c=0,p=this.cols;0<=p?c<p:c>p;a=0<=p?++c:--c)s=o[a],s?(n=s[0],e=s[1]):(d=[" ",r],n=d[0],e=d[1]),e===r?i+=n:(i.length>0&&u.push([i,r]),i=n,r=e);i.length>0&&u.push([i,r]),t[f]=u}return t},e.prototype.clearChanges=function(){return this.dirtyLines={}},e.prototype.getLine=function(e){var t;e==null&&(e=this.cursorY);if(e>=this.lines)throw"cant getLine "+e;return t=this.lineData[e],typeof t=="undefined"&&(t=this.lineData[e]=[],this.fill(e,0,this.cols," ")),t},e.prototype._addEmptyLine=function(e){return this.lineData.splice(e,0,[]),this.clearLineData(e)},e.prototype._removeLine=function(e){return this.lineData.splice(e,1)},e.prototype.reserveCharacters=function(e){var t;return t=this.getLine(),this.lineData[this.cursorY]=t.slice(0,this.cursorX).concat(" ".times(e).split(""),t.slice(this.cursorX,this.cols-e)),this.updateLine()},e.prototype.fill=function(e,t,n,r,i){var s,o,u;i==null&&(i=this.brush),o=this.getLine(e),s=0,u=[];while(s<n)o[t+s]=[r,i],u.push(s++);return u},e.prototype.deleteCharacters=function(e){var t,n;return n=this.getLine(),t=n[n.length-1][1],n.splice(this.cursorX,e),this.fill(this.cursorY,this.cols-e,e," ",t),this.updateLine()},e.prototype.print=function(e){var t,n,r;e=Utf8.decode(e),r=this.cursorY,n=0;while(n<e.length)this.cursorX>=this.cols&&this.goToNextRowFirstColumn(),this.fill(this.cursorY,this.cursorX,1,this.charsetModifier(e[n])),this.cursorX+=1,n++;return t=this.cursorY,this.updateLines(r,t)},e.prototype.clearLineData=function(e){return this.fill(e,0,this.cols," ")},e.prototype.correctCursorPos=function(){this.cursorX<0&&(this.cursorX=0),this.cursorX>=this.cols&&(this.cursorX=this.cols-1),this.cursorY<0&&(this.cursorY=0);if(this.cursorY>=this.lines)return this.cursorY=this.lines-1},e.prototype.priorRow=function(e){var t,n,r;e==null&&(e=1),r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)this.cursorY>0?(this.cursorY-=1,this.updateLine(this.cursorY),r.push(this.updateLine(this.cursorY+1))):r.push(void 0);return r},e.prototype.nextRow=function(e){var t,n,r;e==null&&(e=1),r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)this.cursorY+1<this.lines?(this.cursorY+=1,this.updateLine(this.cursorY-1),r.push(this.updateLine(this.cursorY))):r.push(void 0);return r},e.prototype.nextColumn=function(e){var t,n,r;e==null&&(e=1),r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)r.push(this._cursorRight());return r},e.prototype.priorColumn=function(e){var t,n,r;e==null&&(e=1),r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)r.push(this._cursorLeft());return r},e.prototype._cursorLeft=function(){if(this.cursorX>0)return this.cursorX-=1,this.updateLine()},e.prototype._cursorRight=function(){if(this.cursorX<this.cols-1)return this.cursorX+=1,this.updateLine()},e.prototype.priorRowFirstColumn=function(e){return e==null&&(e=1),this.goToFirstColumn(),this.priorRow(e)},e.prototype.nextRowFirstColumn=function(e){return e==null&&(e=1),this.goToFirstColumn(),this.nextRow(e)},e.prototype.goToColumn=function(e){return e==null&&(e=1),this.cursorX=e-1,this.correctCursorPos(),this.updateLine()},e.prototype.goToRow=function(e){var t;return e==null&&(e=1),t=this.cursorY,this.cursorY=e-1,this.correctCursorPos(),t!==this.cursorY&&this.updateLine(t),this.updateLine()},e.prototype.goToRowAndColumn=function(e,t){return e==null&&(e=1),t==null&&(t=1),this.goToRow(e),this.goToColumn(t)},e.prototype.goToNextHorizontalTabStop=function(e){var t;return t=this.tabStops.next(this.cursorX),this.goToRowAndColumn(this.cursorY+1,t+1),this.updateLine()},e.prototype.goToPriorHorizontalTabStop=function(e){var t;return t=this.tabStops.prev(this.cursorX),this.goToRowAndColumn(this.cursorY+1,t+1),this.updateLine()},e.prototype.clearHorizontalTabStop=function(){return console.log("clearHorizontalTabStop")},e.prototype.clearAllHorizontalTabStops=function(){return console.log("clearAllHorizontalTabStops")},e.prototype.saveCursor=function(){return this.savedCol=this.cursorX,this.savedLine=this.cursorY},e.prototype.restoreCursor=function(){var e;return e=this.cursorY,this.cursorY=this.savedLine,this.cursorX=this.savedCol,this.updateLine(e),this.updateLine()},e.prototype.goToFirstColumn=function(){return this.cursorX=0,this.updateLine()},e.prototype.setBrush=function(e){return this.brush=e},e.prototype.getBrush=function(){return this.brush},e.prototype.saveBrush=function(){return this.savedBrush=this.brush},e.prototype.restoreBrush=function(){return this.brush=this.savedBrush},e.prototype.repeatLastCharacter=function(e){e==null&&(e=1)},e.prototype.updateBrush=function(e){return this.brush=this.brush.applyChanges(e)},e.prototype.inScrollRegion=function(){return this.cursorY>=this.topMargin()&&this.cursorY<=this.bottomMargin()},e.prototype.scrollUp=function(e){return e==null&&(e=1),this.insertLines(e,this.topMargin())},e.prototype.scrollDown=function(e){return e==null&&(e=1),this.deleteLines(e,this.topMargin())},e.prototype.insertLines=function(e,t){var n;t==null&&(t=this.cursorY);if(!this.inScrollRegion())return;n=0;while(n<e)this._removeLine(this.bottomMargin()),this._addEmptyLine(t),n++;return this.updateLines(t,this.bottomMargin())},e.prototype.deleteLines=function(e,t){var n;t==null&&(t=this.cursorY);if(!this.inScrollRegion())return;n=0;while(n<e)this._removeLine(t),this._addEmptyLine(this.bottomMargin()),n++;return this.updateLines(t,this.bottomMargin())},e.prototype.goToPriorRow=function(){return this.cursorY===this.topMargin()?this.scrollUp():this.priorRow()},e.prototype.goToNextRow=function(){return this.cursorY===this.bottomMargin()?this.scrollDown():this.nextRow()},e.prototype.goToNextRowFirstColumn=function(){return this.goToFirstColumn(),this.goToNextRow()},e.prototype.setLineWrap=function(e){},e.prototype.eraseScreen=function(){var e,t;e=0,t=[];while(e<this.lines)this.clearLineData(e),this.updateLine(e),t.push(e++);return t},e.prototype.eraseFromScreenStart=function(){var e;e=0;while(e<this.cursorY)this.clearLineData(e),this.updateLine(e),e++;return this.eraseFromRowStart()},e.prototype.eraseToScreenEnd=function(){var e,t;this.eraseToRowEnd(),e=this.cursorY+1,t=[];while(e<this.lines)this.clearLineData(e),this.updateLine(e),t.push(e++);return t},e.prototype.eraseRow=function(){return this.fill(this.cursorY,0,this.cols," "),this.updateLine()},e.prototype.eraseFromRowStart=function(){return this.fill(this.cursorY,0,this.cursorX," "),this.updateLine()},e.prototype.eraseToRowEnd=function(){return this.fill(this.cursorY,this.cursorX,this.cols-this.cursorX," "),this.updateLine()},e.prototype.eraseCharacters=function(e){return e==null&&(e=1),this.fill(this.cursorY,this.cursorX,e," "),this.updateLine()},e.prototype.setCharset=function(e){this.charset=e;switch(e){case"uk":return this.charsetModifier=this.ukCharsetModifier;case"us":return this.charsetModifier=this.usCharsetModifier;case"special":return this.charsetModifier=this.specialCharsetModifier}},e.prototype.getCharset=function(){return this.charset},e.prototype.usCharsetModifier=function(e){return e},e.prototype.ukCharsetModifier=function(e){return e},e.prototype.specialCharsetModifier=function(e){return AsciiIo.SpecialCharset[e.charCodeAt(0)]||e},e}()}.call(this),function(){AsciiIo.ScrollRegion=function(){function e(e,t){this.top=e,this.bottom=t}return e.prototype.setTop=function(e){this.top=e},e.prototype.setBottom=function(e){this.bottom=e},e.prototype.getTop=function(){return this.top},e.prototype.getBottom=function(){return this.bottom},e.prototype.save=function(){return this.savedTop=this.top,this.savedBottom=this.bottom},e.prototype.restore=function(){return this.top=this.savedTop,this.bottom=this.savedBottom},e}()}.call(this),function(){AsciiIo.SgrInterpreter=function(){function e(){}return e.prototype.parse=function(e){var t,n,r;t={},n=0;while(n<e.length)r=e[n],r===0?(t.fg=void 0,t.bg=void 0,t.blink=!1,t.bright=!1,t.italic=!1,t.underline=!1,t.reverse=!1):r===1?t.bright=!0:r===3?t.italic=!0:r===4?t.underline=!0:r===5?t.blink=!0:r===7?t.reverse=!0:r===23?t.italic=!1:r===24?t.underline=!1:r===25?t.blink=!1:r===27?t.reverse=!1:r>=30&&r<=37?t.fg=r-30:r===38?(t.fg=e[n+2],n+=2):r===39?t.fg=void 0:r>=40&&r<=47?t.bg=r-40:r===48?(t.bg=e[n+2],n+=2):r===49?t.bg=void 0:r>=90&&r<=97?t.fg=r-90:r>=100&&r<=107&&(t.bg=r-100),n++;return t},e}()}.call(this),function(){AsciiIo.SpecialCharset={33:"!",34:'"',35:"#",36:"$",37:"%",38:"&",39:"'",40:"(",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",64:"@",65:"↑",66:"↓",67:"→",68:"←",69:"█",70:"▚",71:"☃",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"[",92:"\\",93:"]",94:"^",95:"_",96:"◆",97:"▒",98:"␉",99:"␌",100:"␍",101:"␊",102:"°",103:"±",104:"␤",105:"␋",106:"┘",107:"┐",108:"┌",109:"└",110:"┼",111:"⎺",112:"⎻",113:"─",114:"⎼",115:"⎽",116:"├",117:"┤",118:"┴",119:"┬",120:"│",121:"≤",122:"≥",123:"π",124:"≠",125:"£",126:"·"}}.call(this),function(){AsciiIo.TabStops=function(){function e(e){var t;this.cols=e,this.stops=function(){var e,n,r;r=[];for(t=e=0,n=this.cols;0<=n?e<n:e>n;t=0<=n?++e:--e)t%8===0&&r.push(t);return r}.call(this)}return e.prototype.add=function(e){var t;if(!_(this.stops).include(e))return t=_(this.stops).sortedIndex(e),this.stops.splice(t,0,e)},e.prototype.next=function(e){var t,n,r,i;i=this.stops;for(n=0,r=i.length;n<r;n++){t=i[n];if(t>e)return t}return this.cols},e.prototype.prev=function(e){var t,n,r,i,s;t=0,s=this.stops;for(r=0,i=s.length;r<i;r++){n=s[r];if(n>e)break;t=n}return t},e}()}.call(this),function(){var e=[].slice;AsciiIo.VT=function(){function t(e,t){this.cols=e,this.lines=t,_.extend(this,Backbone.Events),this.interpreter=new AsciiIo.AnsiInterpreter,this.reset()}return t.prototype.feed=function(t){var n,r,i,s,o,u,a;this.data+=t,a=this.interpreter.parse(this.data),i=a[0],this.data=a[1];for(o=0,u=i.length;o<u;o++)r=i[o],s=r[0],n=2<=r.length?e.call(r,1):[],this[s].apply(this,n);return this.data.length===0},t.prototype.reset=function(){return this.data="",this.resetTerminal()},t.prototype.bell=function(){return this.trigger("bell")},t.prototype.state=function(){return{changes:this.buffer.changes(),cursorX:this.buffer.cursorX,cursorY:this.buffer.cursorY}},t.prototype.clearChanges=function(){return this.buffer.clearChanges()},t.prototype.switchToNormalBuffer=function(){return this.buffer=this.normalBuffer,this.updateScreen()},t.prototype.switchToAlternateBuffer=function(){return this.alternateBuffer.setBrush(this.normalBuffer.getBrush()),this.alternateBuffer.setCharset(this.normalBuffer.getCharset()),this.buffer=this.alternateBuffer,this.updateScreen()},t.prototype.updateScreen=function(){return this.buffer.updateScreen()},t.prototype.carriageReturn=function(){return this.buffer.goToFirstColumn()},t.prototype.backspace=function(){return this.buffer.priorColumn()},t.prototype.showCursor=function(){return this.trigger("cursor-visibility",!0)},t.prototype.hideCursor=function(){return this.trigger("cursor-visibility",!1)},t.prototype.reverseIndex=function(){return this.buffer.goToPriorRow()},t.prototype.lineFeed=function(){return this.buffer.goToNextRow()},t.prototype.verticalTab=function(){return this.buffer.goToNextRow()},t.prototype.formFeed=function(){return this.buffer.goToNextRow()},t.prototype.index=function(){return this.buffer.goToNextRow()},t.prototype.newLine=function(){return this.buffer.goToNextRowFirstColumn()},t.prototype.setScrollRegion=function(e,t){e<1&&(e=1),t>this.lines&&(t=this.lines);if(t>e)return this.scrollRegion.setTop(e-1),this.scrollRegion.setBottom(t-1)},t.prototype.setHorizontalTabStop=function(){return this.tabStops.add(this.cursorX)},t.prototype.resetTerminal=function(){return this.scrollRegion=new AsciiIo.ScrollRegion(0,this.lines-1),this.tabStops=new AsciiIo.TabStops(this.cols),this.normalBuffer=new AsciiIo.ScreenBuffer(this.cols,this.lines,this.scrollRegion,this.tabStops),this.alternateBuffer=new AsciiIo.ScreenBuffer(this.cols,this.lines,this.scrollRegion,this.tabStops),this.buffer=this.normalBuffer,this.fg=this.bg=void 0,this.bright=!1,this.underline=!1,this.italic=!1,this.updateScreen()},t.prototype.saveTerminalState=function(){return this.buffer.saveCursor(),this.scrollRegion.save(),this.buffer.saveBrush()},t.prototype.restoreTerminalState=function(){return this.buffer.restoreBrush(),this.scrollRegion.restore(),this.buffer.restoreCursor()},t.prototype.reportRowAndColumn=function(){},t.prototype.setUkCharset=function(){return this.buffer.setCharset("utf-8")},t.prototype.setUsCharset=function(){return this.buffer.setCharset("utf-8")},t.prototype.setSpecialCharset=function(){return this.buffer.setCharset("utf-8")},t.prototype.print=function(e){return this.buffer.print(e)},t.prototype.reserveCharacters=function(e){return this.buffer.reserveCharacters(e)},t.prototype.priorRow=function(e){return this.buffer.priorRow(e)},t.prototype.nextRow=function(e){return this.buffer.nextRow(e)},t.prototype.nextColumn=function(e){return this.buffer.nextColumn(e)},t.prototype.priorColumn=function(e){return this.buffer.priorColumn(e)},t.prototype.nextRowFirstColumn=function(e){return this.buffer.nextRowFirstColumn(e)},t.prototype.priorRowFirstColumn=function(e){return this.buffer.priorRowFirstColumn(e)},t.prototype.goToColumn=function(e){return this.buffer.goToColumn(e)},t.prototype.goToRowAndColumn=function(e,t){return this.buffer.goToRowAndColumn(e,t)},t.prototype.goToNextHorizontalTabStop=function(e){return e==null&&(e=1),this.buffer.goToNextHorizontalTabStop(e)},t.prototype.eraseScreen=function(){return this.buffer.eraseScreen()},t.prototype.eraseFromScreenStart=function(){return this.buffer.eraseFromScreenStart()},t.prototype.eraseToScreenEnd=function(){return this.buffer.eraseToScreenEnd()},t.prototype.eraseRow=function(){return this.buffer.eraseRow()},t.prototype.eraseFromRowStart=function(){return this.buffer.eraseFromRowStart()},t.prototype.eraseToRowEnd=function(){return this.buffer.eraseToRowEnd()},t.prototype.insertLines=function(e){return this.buffer.insertLines(e)},t.prototype.deleteLines=function(e){return this.buffer.deleteLines(e)},t.prototype.deleteCharacters=function(e){return this.buffer.deleteCharacters(e)},t.prototype.scrollUp=function(e){return this.buffer.scrollUp(e)},t.prototype.scrollDown=function(e){return this.buffer.scrollDown(e)},t.prototype.eraseCharacters=function(e){return this.buffer.eraseCharacters(e)},t.prototype.goToPriorHorizontalTabStop=function(e){return this.buffer.goToPriorHorizontalTabStop(e)},t.prototype.repeatLastCharacter=function(e){return this.buffer.repeatLastCharacter(e)},t.prototype.goToRow=function(e){return this.buffer.goToRow(e)},t.prototype.clearHorizontalTabStop=function(){return this.buffer.clearHorizontalTabStop()},t.prototype.clearAllHorizontalTabStops=function(){return this.buffer.clearAllHorizontalTabStops()},t.prototype.updateBrush=function(e){return this.buffer.updateBrush(e)},t}()}.call(this),function(){var e=[].slice;AsciiIo.Movie=function(){function t(e){this.options=e,_.extend(this,Backbone.Events),this.reset(),this.startTimeReporter()}return t.prototype.MIN_DELAY=.01,t.prototype.reset=function(){return this.frameNo=0,this.dataIndex=0,this.completedFramesTime=0,this.playing=!1,this.lastFrameAt=void 0,this.framesProcessed=0,this.clearPauseState(),this.trigger("reset")},t.prototype.call=function(){var t,n;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],this[n].apply(this,t)},t.prototype.now=function(){return(new Date).getTime()},t.prototype.timing=function(){return this.options.timing},t.prototype.mp3=function(){return this.options.mp3},t.prototype.data=function(){return this.options.stdout_data},t.prototype.play=function(){if(this.isPlaying())return;return this.isFinished()?this.restart():this.isPaused()?this.resume():this.start()},t.prototype.start=function(){return this.playing=!0,this.trigger("started"),this.lastFrameAt=this.now(),this.nextFrame()},t.prototype.stop=function(){var e;return this.playing=!1,this.cancelNextFrameProcessing(),e=this.now(),this.adjustFrameWaitTime(e),this.pausedAt=e},t.prototype.cancelNextFrameProcessing=function(){return clearInterval(this.nextFrameTimeoutId)},t.prototype.adjustFrameWaitTime=function(e){var t,n;return n=this.resumedAt||this.lastFrameAt,t=e-n,this.totalFrameWaitTime+=t},t.prototype.restart=function(){return this.reset(),this.start()},t.prototype.pause=function(){if(this.isPaused())return;return this.stop(),this.trigger("paused")},t.prototype.resume=function(){var e,t,n,r,i;if(this.isPlaying())return;return this.playing=!0,this.resumedAt=this.now(),i=this.timing()[this.frameNo],t=i[0],e=i[1],r=t*1e3,n=r-this.totalFrameWaitTime,this.processFrameWithDelay(n),this.trigger("resumed")},t.prototype.togglePlay=function(){return this.isPlaying()?this.pause():this.play()},t.prototype.isPlaying=function(){return this.playing},t.prototype.isPaused=function(){return!this.isPlaying()&&!this.isFinished()&&this.frameNo>0},t.prototype.isFinished=function(){return!this.isPlaying()&&this.frameNo>=this.timing().length},t.prototype.seek=function(e){return this.stop(),this.rewindTo(e),this.resume()},t.prototype.rewindTo=function(e){var t,n,r,i,s,o,u,a,f,l;i=this.options.duration,o=i*e/100,s=0,u=0,a=0,r=void 0,t=void 0;while(u<o)l=this.timing()[s],r=l[0],t=l[1],u+=r,a+=t,s+=1;return this.frameNo=s,this.completedFramesTime=u*1e3,this.dataIndex=a,n=this.data().slice(0,a),this.trigger("reset"),this.trigger("data",[n]),this.lastFrameAt=this.now(),f=o-u,this.totalFrameWaitTime=f*1e3},t.prototype.startTimeReporter=function(){var e=this;return this.timeReportId=setInterval(function(){return e.trigger("time",e.currentTime())},500)},t.prototype.stopTimeReporter=function(){return clearInterval(this.timeReportId)},t.prototype.currentTime=function(){return this.completedFramesTime+this.currentFrameTime()},t.prototype.currentFrameTime=function(){return this.isPlaying()?this.playingFrameTime():this.isPaused()?this.pausedFrameTime():0},t.prototype.playingFrameTime=function(){return this.frameWasPaused()?this.currentFrameWithPauseTime():this.currentFrameWithNoPauseTime()},t.prototype.frameWasPaused=function(){return!!this.pausedAt},t.prototype.currentFrameWithPauseTime=function(){return this.totalFrameWaitTime+this.sinceResumeTime()},t.prototype.currentFrameWithNoPauseTime=function(){return this.now()-this.lastFrameAt},t.prototype.sinceResumeTime=function(){return this.now()-this.resumedAt},t.prototype.pausedFrameTime=function(){return this.totalFrameWaitTime},t.prototype.clearPauseState=function(){return this.pausedAt=void 0,this.resumedAt=void 0,this.totalFrameWaitTime=0},t.prototype.nextFrame=function(){var e,t,n,r;return(n=this.timing()[this.frameNo])?(t=n[0],e=n[1],this.framesProcessed=0,r=t*1e3*(1/this.options.speed),this.processFrameWithDelay(r),!0):(this.playing=!1,this.trigger("finished"),!1)},t.prototype.processFrameWithDelay=function(e){var t=this;return this.nextFrameTimeoutId=setTimeout(function(){return t.trigger("wakeup"),t.processFrame()},e)},t.prototype.processFrame=function(){var e,t,n,r;return n=this.timing()[this.frameNo],t=n[0],e=n[1],r=this.data().slice(this.dataIndex,this.dataIndex+e),this.trigger("data",[r]),this.frameNo+=1,this.dataIndex+=e,this.completedFramesTime+=t*1e3,this.lastFrameAt=this.now(),this.clearPauseState(),this.nextFrame()},t}()}.call(this),function(){var e,t,n=this,r=[].slice;t=void 0,e=void 0,addEventListener("message",function(r){var i;i=r.data;switch(i.message){case"init":return n.initialize(i.options);case"call":switch(i.objectName){case"vt":return t[i.method].apply(t,i.args);case"movie":return e[i.method].apply(e,i.args)}}}),this.initialize=function(n){var i=this;return t=new AsciiIo.VT(n.cols,n.lines),t.on("all",function(){var e,t;return t=arguments[0],e=2<=arguments.length?r.call(arguments,1):[],postMessage({evt:t,src:"vt",args:e})}),e=new AsciiIo.Movie({timing:n.timing,stdout_data:n.stdout_data,duration:n.duration,speed:n.speed,benchmark:n.benchmark,cols:n.cols,lines:n.lines}),e.on("all",function(){var e,t;return t=arguments[0],e=2<=arguments.length?r.call(arguments,1):[],postMessage({evt:t,src:"movie",args:e})}),e.on("reset",function(){return t.reset()}),e.on("data",function(n){var r;return t.feed(n),r=t.state(),t.clearChanges(),e.trigger("render",r)}),console.log("inited!")}}.call(this);