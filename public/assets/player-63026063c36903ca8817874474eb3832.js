// Taken from: https://gist.github.com/1579671
// http://paulirish.com/2011/requestanimationframe-for-smart-animating/
// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
// requestAnimationFrame polyfill by Erik Möller
// fixes from Paul Irish and Tino Zijdel
(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})(),function(){var e=typeof window!="undefined"?window:exports,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=function(){try{document.createElement("$")}catch(e){return e}}();e.btoa||(e.btoa=function(e){for(var r,i,s=0,o=t,u="";e.charAt(s|0)||(o="=",s%1);u+=o.charAt(63&r>>8-s%1*8)){i=e.charCodeAt(s+=.75);if(i>255)throw n;r=r<<8|i}return u}),e.atob||(e.atob=function(e){e=e.replace(/=+$/,"");if(e.length%4==1)throw n;for(var r=0,i,s,o=0,u="";s=e.charAt(o++);~s&&(i=r%4?i*64+s:s,r++%4)?u+=String.fromCharCode(255&i>>(-2*r&6)):0)s=t.indexOf(s);return u})}();var ArchUtils=function(){"use strict";function e(e,t){var n=e.length;if(t>=n)throw RangeError("Out of bound");if(t<0)throw RangeError("Out of bound");var r=e;e=e.join(""),r.sort();var i={};for(var s=n-1;s>=0;s--)i[r[s]]=s;var o=[];for(s=0;s<n;s++)o.push(i[e[s]]++);var s,u=r[s=t],a=[];for(var f=1;f<n;f++)a.push(r[s=o[s]]);return u+a.reverse().join("")}function t(e,t,n){var r=e[t];for(var i=t;i>0;e[i]=e[--i]);n.push(e[0]=r)}var n=function(){this.init=function(e){this.masks=[];for(var t=0;t<31;t++)this.masks[t]=(1<<t)-1;this.masks[31]=-2147483648,this.f=e,this.bits=0,this.bitfield=0,this.count=0},this.readbits2=function(t){var n=t>>1;return this.readbits(n)*(1<<n)+this.readbits(t-n)},this.readbits=function(t){while(this.bits<t)this.bitfield=(this.bitfield<<8)+this.f.charCodeAt(this.count++),this.bits+=8;var n=this.masks[t],r=this.bitfield>>this.bits-t&n;return this.bits-=t,this.bitfield&=~(n<<this.bits),r}},r=function(e,t){this.code=e,this.bits=t,this.symbol=undefined},i=function(){this.process=function(e){var t=e.length,n=[];for(var i=0;i<t;i++)n.push([i,e[i]]);n.push([t,-1]);var s=[],o=n[0],u=o[0],a=o[1];for(var f=1;f<n.length;f++){var l=n[f][0],c=n[f][1];if(a)for(var h=u;h<l;h++)s.push(new r(h,a));u=l,a=c;if(c==-1)break}s.sort(function(e,t){return e.bits-t.bits||e.code-t.code}),this.table=s;var p=0,d=-1;this.faht=[];var v=null;for(var i=0;i<this.table.length;i++){var m=this.table[i];d+=1,m.bits!=p&&(d<<=m.bits-p,v=this.faht[p=m.bits]={}),v[m.symbol=d]=m}this.min_bits=16,this.max_bits=-1,this.table.forEach(function(e){e.bits<this.min_bits&&(this.min_bits=e.bits),e.bits>this.max_bits&&(this.max_bits=e.bits)},this)}};return{bz2:{decode:function(r){function a(e){var t=[],n=e.readbits(16);for(var r=32768;r>0;r>>=1){if(!(n&r)){for(var i=0;i<16;i++)t.push(!1);continue}var s=e.readbits(16);for(var o=32768;o>0;o>>=1)t.push(Boolean(s&o))}return t}function l(){for(;;){var n=s.readbits2(48),r=s.readbits2(32);if(n!=54156738319193){if(n==25779555029136){s.readbits(s.bits&7);break}throw"Illegal Bzip2 blocktype = 0x"+n.toString(16)}if(s.readbits(1))throw"Bzip2 randomised support not implemented";var o=s.readbits(24),u=a(s),l=s.readbits(3);if(2>l||l>6)throw RangeError("Bzip2: Number of Huffman groups not in range 2..6");var c=[0,1,2,3,4,5,6].slice(0,l),h=[];for(var p=0,d=s.readbits(15);p<d;p++){var v=0;while(s.readbits(1))if(v++>=l)throw RangeError("More than max ("+l+") groups");t(c,v,h)}var m=[],g=u.reduce(function(e,t){return e+t},0)+2;for(var y=0;y<l;y++){var w=s.readbits(5),E=[];for(var p=0;p<g;p++){if(w<0||w>20)throw RangeError("Bzip2 Huffman length code outside range 0..20");while(s.readbits(1))w-=s.readbits(1)*2-1;E.push(w)}m.push(E)}var S=[];for(var x=0;x<m.length;x++){var T=new i;T.process(m[x]),S.push(T)}var N=[];for(var v=u.length-1;v>=0;v--)u[v]&&N.push(String.fromCharCode(v));N.reverse();var C=0,k=0,L,A=0,O=0,M=[],_;for(;;){--k<=0&&(k=50,C<=h.length&&(L=S[h[C++]]));for(var D in L.faht){s.bits<D&&(s.bitfield=(s.bitfield<<8)+s.f.charCodeAt(s.count++),s.bits+=8);if(_=L.faht[D][s.bitfield>>s.bits-D]){s.bitfield&=s.masks[s.bits-=D],_=_.code;break}}if(0<=_&&_<=1){A==0&&(O=1),A+=O<<_,O<<=1;continue}var P=N[0];for(;A>0;A--)M.push(P);if(_==g-1)break;t(N,_-1,M)}var H=e(M,o),B=[],p=0,j=H.length;while(p<j){var v=H.charCodeAt(p);if(p<j-4&&H.charCodeAt(p+1)==v&&H.charCodeAt(p+2)==v&&H.charCodeAt(p+3)==v){var v=H.charAt(p),F=H.charCodeAt(p+4)+4;for(;F>0;F--)B.push(v);p+=5}else B.push(H[p++])}f.push(B.join(""))}}var s=new n;s.init(r),s.readbits(16);var o=s.readbits(8);if(o!=104)throw"Unknown (not type 'h'uffman Bzip2) compression method";var u=s.readbits(8);if(49<=u&&u<=57){u-=48;var f=[];return l(),f.join("")}throw"Unknown (not size '1'-'9') Bzip2 blocksize"}}}}(),Utf8={encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t},decode:function(e){var t="",n=0,r=c1=c2=0;while(n<e.length)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((r&31)<<6|c2&63),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63),n+=3);return t}};(function(){String.prototype.times=function(e){return Array.prototype.join.call({length:e+1},this)}}).call(this),window.AsciiIo||(window.AsciiIo={}),AsciiIo.Renderer={},function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};AsciiIo.Renderer.Base=function(t){function r(){return this.render=e(this.render,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.events={click:"onClick"},r.prototype.initialize=function(e){return this.cols=e.cols,this.lines=e.lines,this.showCursor(!0),this.startCursorBlink(),this.clearState(),requestAnimationFrame(this.render)},r.prototype.clearState=function(){return this.state={changes:{},cursorX:void 0,cursorY:void 0,dirty:!1}},r.prototype.onClick=function(){return this.trigger("terminal-click")},r.prototype.push=function(e){return _(this.state.changes).extend(e.changes),this.state.cursorX=e.cursorX,this.state.cursorY=e.cursorY,this.state.dirty=!0},r.prototype.render=function(){var e,t,n,r;requestAnimationFrame(this.render);if(this.state.dirty){r=this.state.changes;for(n in r)t=r[n],e=parseInt(n)===this.state.cursorY?this.state.cursorX:void 0,this.renderLine(n,t||[],e);return this.clearState()}},r.prototype.renderLine=function(e,t,n){throw"#renderLine not implemented"},r.prototype.afterInsertedToDom=function(){var e,t;return e=$('<span class="font-sample"><span class="line"><span>M</span></span></span>'),t=e.find("span span"),this.$el.parent().append(e),this.cellWidth=e.width(),this.cellHeight=t.height()+parseInt(t.css("padding-top"))+parseInt(t.css("padding-bottom")),e.remove(),this.fixTerminalElementSize(),this.fixPlayerContainerSize()},r.prototype.renderSnapshot=function(e){var t,n,r,i,s,o,u;n=0,o=e.split("\n"),u=[];for(i=0,s=o.length;i<s;i++)r=o[i],t=[[r,AsciiIo.Brush["default"]()]],this.renderLine(n,t,void 0),u.push(n++);return u},r.prototype.fixTerminalElementSize=function(){},r.prototype.fixPlayerContainerSize=function(){return this.$el.parent(".player").css({width:this.$el.outerWidth()+"px"})},r.prototype.showCursor=function(e){throw"#showCursor not implemented"},r.prototype.blinkCursor=function(){throw"#blinkCursor not implemented"},r.prototype.resetCursorState=function(){},r.prototype.startCursorBlink=function(){return this.cursorTimerId=setInterval(this.blinkCursor.bind(this),500)},r.prototype.stopCursorBlink=function(){if(this.cursorTimerId)return clearInterval(this.cursorTimerId),this.cursorTimerId=null},r.prototype.restartCursorBlink=function(){return this.stopCursorBlink(),this.resetCursorState(),this.startCursorBlink()},r.prototype.visualBell=function(){},r}(Backbone.View)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};AsciiIo.Renderer.Canvas=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.tagName="canvas",n.prototype.className="terminal",n.prototype.events={click:"onClick"},n.prototype.initialize=function(e){return n.__super__.initialize.call(this,e),this.ctx=this.el.getContext("2d"),this.cursorOn=!0,this.cursorVisible=!0},n.prototype.fixTerminalElementSize=function(){var e,t;return t=this.cols*this.cellWidth,e=this.lines*this.cellHeight,this.$el.attr("width",t),this.$el.attr("height",e),this.setFont()},n.prototype.setFont=function(){var e,t;return t=this.$el.css("font-size"),e=this.$el.css("font-family"),this.font=""+t+" "+e,this.ctx.font=this.font,this.prevFont=this.font,this.ctx.textBaseline="bottom"},n.prototype.renderLine=function(e,t,n){var r,i,s,o,u,a,f,l,c,h;o=0,l=this.cols*this.cellWidth,f=e*this.cellHeight,i=void 0,u=0;for(c=0,h=t.length;c<h;c++)s=t[c],a=s[0],r=s[1],r&&(r=AsciiIo.Brush.create(r)),n!==void 0&&u<=n&&n<u+a.length&&(this.cursorBrush=r,this.cursorText=a[n-u],this.cursorX=n,this.cursorY=e),this.setBackgroundAttributes(r),this.ctx.fillRect(o,f,a.length*this.cellWidth,this.cellHeight),a.match(/^\s*$/)||(this.setTextAttributes(r),this.ctx.fillText(a,o,f+this.cellHeight)),o+=a.length*this.cellWidth,u+=a.length;if(n)return this.renderCursor()},n.prototype.setBackgroundAttributes=function(e){return this.ctx.fillStyle=AsciiIo.colors[e.bgColor()]},n.prototype.setTextAttributes=function(e){var t;this.ctx.fillStyle=AsciiIo.colors[e.fgColor()],t=this.font;if(e.bright||e.italic)e.bright&&(t="bold "+t),e.italic&&(t="italic "+t);if(t!==this.prevFont)return this.ctx.font=t,this.prevFont=t},n.prototype.renderCursor=function(){var e,t;if(!this.cursorOn||!this.cursorText)return;return e=this.cursorX*this.cellWidth,t=this.cursorY*this.cellHeight,this.cursorVisible?(this.ctx.fillStyle=AsciiIo.colors[7],this.ctx.fillRect(e,t,this.cellWidth,this.cellHeight),this.ctx.fillStyle=AsciiIo.colors[0],this.ctx.fillText(this.cursorText,e,t+this.cellHeight)):(this.ctx.fillStyle=AsciiIo.colors[this.cursorBrush.bgColor()],this.ctx.fillRect(e,t,this.cellWidth,this.cellHeight),this.ctx.fillStyle=AsciiIo.colors[this.cursorBrush.fgColor()],this.ctx.fillText(this.cursorText,e,t+this.cellHeight))},n.prototype.showCursor=function(e){return this.cursorOn=e},n.prototype.blinkCursor=function(){return this.cursorVisible=!this.cursorVisible,this.renderCursor()},n.prototype.resetCursorState=function(){return this.cursorVisible=!0,this.renderCursor()},n}(AsciiIo.Renderer.Base)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};AsciiIo.Renderer.Pre=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.tagName="pre",n.prototype.className="terminal",n.prototype.initialize=function(e){return n.__super__.initialize.call(this,e),this.cachedSpans={},this.createChildElements()},n.prototype.createChildElements=function(){var e,t,n;e=0,n=[];while(e<this.lines)t=$('<span class="line">'),this.$el.append(t),this.$el.append("\n"),n.push(e++);return n},n.prototype.fixTerminalElementSize=function(){var e,t;return t=this.cols*this.cellWidth,e=this.lines*this.cellHeight,this.$el.css({width:t+"px",height:e+"px"})},n.prototype.render=function(){return this.state.dirty&&this.$el.find(".cursor").removeClass("cursor"),n.__super__.render.apply(this,arguments)},n.prototype.renderLine=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p;o=[],a=0;for(h=0,p=t.length;h<p;h++)s=t[h],c=s[0],r=s[1],n!==void 0&&a<=n&&n<a+c.length?(u=c.slice(0,n-a),i='<span class="cursor visible">'+c[n-a]+"</span>",f=c.slice(n-a+1),l=this.escape(u)+i+this.escape(f)):l=this.escape(c),o.push(this.spanFromBrush(r)),o.push(l),o.push("</span>"),a+=c.length;return this.$el.find(".line:eq("+e+")")[0].innerHTML="<span>"+o.join("")+"</span>"},n.prototype.escape=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},n.prototype.spanFromBrush=function(e){var t,n;return e=AsciiIo.Brush.create(e),t=e.hash(),n=this.cachedSpans[t],n||(n="",e!==AsciiIo.Brush["default"]()&&(n='<span class="',e.hasDefaultFg()||(n+=" fg"+e.fgColor()),e.hasDefaultBg()||(n+=" bg"+e.bgColor()),e.bright&&(n+=" bright"),e.underline&&(n+=" underline"),e.italic&&(n+=" italic"),n+='">'),this.cachedSpans[t]=n),n},n.prototype.showCursor=function(e){return e?this.$el.addClass("cursor-on"):this.$el.removeClass("cursor-on")},n.prototype.blinkCursor=function(){var e;return e=this.$el.find(".cursor"),e.hasClass("visible")?e.removeClass("visible"):e.addClass("visible")},n.prototype.resetCursorState=function(){var e;return e=this.$el.find(".cursor"),e.addClass("visible")},n.prototype.clearScreen=function(){return this.$el.find(".line").empty()},n}(AsciiIo.Renderer.Base)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};AsciiIo.HudView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.tagName="pre",n.prototype.className="hud",n.prototype.events={"click .toggle":"togglePlay","click .progress span":"seek"},n.prototype.initialize=function(e){return this.duration=void 0,this.cols=e.cols,this.lastArrowWidth=void 0,this.calculateElementWidths(),this.createChildViews()},n.prototype.calculateElementWidths=function(){return this.toggleWidth=4,this.timeWidth=7,this.progressWidth=this.cols-this.toggleWidth-this.timeWidth},n.prototype.createChildViews=function(){var e,t,n;return n='<span class="toggle"> <span class="play">=></span><span class="pause">||</span> ',e='<span class="progress">',t='<span class="time">',this.$el.append(n),this.$el.append(e),this.$el.append(t)},n.prototype.setDuration=function(e){this.duration=e},n.prototype.togglePlay=function(){return this.trigger("play-click")},n.prototype.seek=function(e){var t,n;return t=$(e.target).index(),n=100*t/(this.progressWidth-2),this.trigger("seek-click",n)},n.prototype.onPause=function(){return this.$(".toggle").addClass("paused")},n.prototype.onResume=function(){return this.$(".toggle").removeClass("paused")},n.prototype.updateTime=function(e){var t;this.$(".time").html(this.formattedTime(e));if(this.duration)return t=Math.round(100*e/1e3/this.duration),this.setProgress(t)},n.prototype.setProgress=function(e){var t,n,r,i,s,o;n=Math.floor(e/100*(this.progressWidth-3)),n<1&&(n=1);if(n!==this.lastArrowWidth)return t="=".times(n)+">",s=" ".times(this.progressWidth-3-n),r=t+s,i=_(r.split("")).map(function(e){return"<span>"+e+"</span>"}),o=i.join(""),this.$(".progress").html("["+o+"]"),this.lastArrowWidth=n},n.prototype.formattedTime=function(e){var t,n,r;return r=e/1e3,t=Math.floor(r/60),n=Math.floor(r%60)," "+this.pad2(t)+":"+this.pad2(n)+" "},n.prototype.pad2=function(e){return e<10?"0"+e:e},n}(Backbone.View)}.call(this),function(){AsciiIo.DataUnpacker=function(){function e(){}return e.prototype.unpack=function(e,t){var n,r,i,s=this;return n=atob(e),window.Worker?(i=new Worker(window.unpackWorkerPath),i.onmessage=function(e){return t(e.data)},i.postMessage(n)):(r=ArchUtils.bz2.decode(n),t(r))},e}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};AsciiIo.AbstractPlayer=function(){function t(t){this.options=t,this.onModelDataUnpacked=e(this.onModelDataUnpacked,this),this.onModelFetched=e(this.onModelFetched,this),this.model=this.options.model,this.createView(),this.fetchModel()}return t.prototype.createView=function(){return this.view=new AsciiIo.PlayerView({el:this.options.el,model:this.model,cols:this.options.cols,lines:this.options.lines,hud:this.options.hud,rendererClass:this.options.rendererClass,snapshot:this.options.snapshot})},t.prototype.createVT=function(){throw"not implemented"},t.prototype.createMovie=function(){throw"not implemented"},t.prototype.movieOptions=function(){return{timing:this.model.get("stdout_timing_data"),stdout_data:this.model.get("stdout_data"),duration:this.model.get("duration"),speed:this.options.speed,benchmark:this.options.benchmark,cols:this.options.cols,lines:this.options.lines}},t.prototype.fetchModel=function(){return this.model.fetch({success:this.onModelFetched})},t.prototype.onModelFetched=function(){var e,t;return e=this.model.get("escaped_stdout_data"),t=new AsciiIo.DataUnpacker,t.unpack(e,this.onModelDataUnpacked)},t.prototype.onModelDataUnpacked=function(e){return this.model.set({stdout_data:e}),this.onModelReady()},t.prototype.onModelReady=function(){return this.createVT(),this.createMovie(),this.bindEvents(),this.view.onModelReady(),this.options.autoPlay?this.movie.call("play"):this.view.showPlayOverlay()},t.prototype.bindEvents=function(){var e=this;this.view.on("play-clicked",function(){return e.movie.call("togglePlay")}),this.view.on("seek-clicked",function(t){return e.movie.call("seek",t)}),this.vt.on("cursor-visibility",function(t){return e.view.showCursor(t)}),this.movie.on("started",function(){return e.view.onStateChanged("playing")}),this.movie.on("paused",function(){return e.view.onStateChanged("paused")}),this.movie.on("finished",function(){return e.view.onStateChanged("finished")}),this.movie.on("resumed",function(){return e.view.onStateChanged("resumed")}),this.movie.on("wakeup",function(){return e.view.restartCursorBlink()}),this.movie.on("time",function(t){return e.view.updateTime(t)}),this.movie.on("render",function(t){return e.view.renderState(t)});if(this.options.benchmark)return this.movie.on("started",function(){return e.startedAt=(new Date).getTime()}),this.movie.on("finished",function(){var t;return t=(new Date).getTime(),console.log("finished in "+(t-e.startedAt)/1e3+"s")})},t}()}.call(this),function(){AsciiIo.AnsiInterpreter=function(){function e(){this.sgrInterpreter=new AsciiIo.SgrInterpreter}return e.prototype.parse=function(e){var t;this.commands=[];while(e.length>0){t=this.handleData(e);if(t===0)break;e=e.slice(t)}return[this.commands,e]},e.prototype.cb=function(){return this.commands.push(arguments)},e.prototype.handleData=function(e){var t;return e.match(/^\x1b[\x00-\x1f]/)?(this.handleControlCharacter(e[1]),2):(t=e.match(/^(\x1b\x5d|\x9d).*?(\x1b\\|\x9c|\x07)/))?t[0].length:(t=e.match(/^(\x1b[PX_^]|[\x90\x98\x9e\x9f]).*?(\x1b\\|\x9c)/))?t[0].length:(t=e.match(/^(?:\x1b\x5b|\x9b)([\x30-\x3f]*?)[\x20-\x2f]*?[\x40-\x7e]/))?(this.handleControlSequence(t[0],t[1],t),t[0].length):(t=e.match(/^\x1b[\x20-\x2f]*?[\x30-\x3f]/))?(this.handlePrivateEscSeq(t[0]),t[0].length):(t=e.match(/^\x1b[\x20-\x2f]*?[\x40-\x5a\x5c\x5e-\x7e]/))?(this.handleStandardEscSeq(t[0]),t[0].length):e.match(/^\x1b\x7f/)?2:e.match(/^[\x00-\x1a\x1c-\x1f]/)?(this.handleControlCharacter(e[0]),1):(t=e.match(/^([\x20-\x7e]|[\xe2-\xe9]..|[\xc2-\xc5].|[\xa1-\xfe])+/))?(this.handlePrintableCharacters(t[0]),t[0].length):e[0]===""?1:e.match(/^[\x80-\x9f]/)?(this.handleControlCharacter(e[0]),1):e[0]===" "?(this.handlePrintableCharacters(" "),1):e[0]==="ÿ"?1:0},e.prototype.handleControlCharacter=function(e){var t;t=function(){switch(e){case"":return"bell";case"\b":return"backspace";case"	":return"goToNextHorizontalTabStop";case"\n":return"lineFeed";case"":return"verticalTab";case"\f":return"formFeed";case"\r":return"carriageReturn";case"":return"index";case"":return"newLine";case"":return"setHorizontalTabStop";case"":return"reverseIndex"}}();if(t)return this.cb(t)},e.prototype.handlePrintableCharacters=function(e){return this.cb("print",e)},e.prototype.handleStandardEscSeq=function(e){var t,n,r;r=e[e.length-1],n=e[e.length-2],t=function(){switch(r){case"A":if(n==="(")return"setUkCharset";break;case"B":if(n==="(")return"setUsCharset";break;case"D":return"index";case"E":return"newLine";case"H":return"setHorizontalTabStop";case"M":return"reverseIndex";case"c":return"resetTerminal"}}();if(t)return this.cb(t)},e.prototype.handlePrivateEscSeq=function(e){var t,n,r;r=e[e.length-1],n=e[e.length-2],t=function(){switch(r){case"0":if(n==="(")return"setSpecialCharset";break;case"7":return"saveTerminalState";case"8":return"restoreTerminalState"}}();if(t)return this.cb(t)},e.prototype.handleControlSequence=function(e,t,n){return t&&t.match(/^[\x3c-\x3f]/)?this.handlePrivateControlSequence(e,t):this.handleStandardControlSequence(e,t)},e.prototype.handleStandardControlSequence=function(e,t){var n,r,i,s;s=e[e.length-1],i=this.parseParams(t),r=i[0],n=i[1];switch(s){case"@":return this.cb("reserveCharacters",r);case"A":return r===void 0&&(r=1),this.cb("priorRow",r);case"B":return r===void 0&&(r=1),this.cb("nextRow",r);case"C":return r===void 0&&(r=1),this.cb("nextColumn",r);case"D":return r===void 0&&(r=1),this.cb("priorColumn",r);case"E":return this.cb("nextRowFirstColumn",r);case"F":return this.cb("priorRowFirstColumn",r);case"G":return r===void 0&&(r=1),this.cb("goToColumn",r);case"H":return r===void 0&&(r=1),n===void 0&&(n=1),this.cb("goToRowAndColumn",r,n);case"I":return this.cb("goToNextHorizontalTabStop",r);case"J":return r===2?this.cb("eraseScreen"):r===1?this.cb("eraseFromScreenStart"):this.cb("eraseToScreenEnd");case"K":return r===2?this.cb("eraseRow"):r===1?this.cb("eraseFromRowStart"):this.cb("eraseToRowEnd");case"L":return this.cb("insertLines",r||1);case"M":return this.cb("deleteLines",r||1);case"P":return this.cb("deleteCharacters",r||1);case"S":return this.cb("scrollUp",r);case"T":return this.cb("scrollDown",r);case"X":return this.cb("eraseCharacters",r);case"Z":return this.cb("goToPriorHorizontalTabStop",r);case"b":return this.cb("repeatLastCharacter",r);case"d":return this.cb("goToRow",r);case"f":return this.cb("goToRowAndColumn",r,n);case"g":if(!r||r===0)return this.cb("clearHorizontalTabStop");if(r===3)return this.cb("clearAllHorizontalTabStops");break;case"l":return console.log("(TODO) reset: "+r);case"m":return this.handleSGR(i);case"n":return this.cb("reportRowAndColumn");case"r":return r===void 0&&(r=1),n===void 0&&(n=this.lines),this.cb("setScrollRegion",r,n)}},e.prototype.handlePrivateControlSequence=function(e,t){var n,r,i,s,o,u;n=e[e.length-1],i=this.parseParams(t),u=[];for(s=0,o=i.length;s<o;s++)r=i[s],r===25?n==="h"?u.push(this.cb("showCursor")):n==="l"?u.push(this.cb("hideCursor")):u.push(void 0):r===47?n==="h"?u.push(this.cb("switchToAlternateBuffer")):n==="l"?u.push(this.cb("switchToNormalBuffer")):u.push(void 0):r===1049?n==="h"?(this.cb("switchToAlternateBuffer"),u.push(this.cb("eraseScreen"))):n==="l"?(this.cb("eraseScreen"),u.push(this.cb("switchToNormalBuffer"))):u.push(void 0):u.push(void 0);return u},e.prototype.parseParams=function(e){var t;return e.length===0?t=[]:t=_(e.replace(/[^0-9;]/,"").split(";")).map(function(e){return e===""?void 0:parseInt(e,10)}),t},e.prototype.handleSGR=function(e){var t;return e.length===0&&(e=[0]),t=this.sgrInterpreter.parse(e),this.cb("updateBrush",t)},e.prototype.formattedData=function(e){var t,n,r;return n=e.slice(0,100),r=function(){var e,r,i;i=[];for(e=0,r=n.length;e<r;e++)t=n[e],i.push("0x"+t.charCodeAt(0).toString(16));return i}(),Utf8.decode(n)+" ("+r.join()+")"},e}()}.call(this),function(){AsciiIo.ScreenBuffer=function(){function e(e,t,n,r){this.cols=e,this.lines=t,this.scrollRegion=n,this.tabStops=r,this.lineData=[],this.dirtyLines={},this.cursorX=0,this.cursorY=0,this.setBrush(AsciiIo.Brush["default"]()),this.setCharset("us")}return e.prototype.topMargin=function(){return this.scrollRegion.getTop()},e.prototype.bottomMargin=function(){return this.scrollRegion.getBottom()},e.prototype.updateLine=function(e){return e==null&&(e=this.cursorY),this.dirtyLines[e]=!0},e.prototype.updateLines=function(e,t){var n,r;n=e,r=[];while(n<=t)this.updateLine(n),r.push(n++);return r},e.prototype.updateScreen=function(){var e,t,n,r;r=[];for(e=t=0,n=this.lines;0<=n?t<n:t>n;e=0<=n?++t:--t)r.push(this.updateLine(e));return r},e.prototype.changes=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d;t={},h=this.dirtyLines;for(f in h){l=h[f],o=this.lineData[f]||[],u=[],r=AsciiIo.Brush["default"](),i="";for(a=c=0,p=this.cols;0<=p?c<p:c>p;a=0<=p?++c:--c)s=o[a],s?(n=s[0],e=s[1]):(d=[" ",r],n=d[0],e=d[1]),e===r?i+=n:(i.length>0&&u.push([i,r]),i=n,r=e);i.length>0&&u.push([i,r]),t[f]=u}return t},e.prototype.clearChanges=function(){return this.dirtyLines={}},e.prototype.getLine=function(e){var t;e==null&&(e=this.cursorY);if(e>=this.lines)throw"cant getLine "+e;return t=this.lineData[e],typeof t=="undefined"&&(t=this.lineData[e]=[],this.fill(e,0,this.cols," ")),t},e.prototype._addEmptyLine=function(e){return this.lineData.splice(e,0,[]),this.clearLineData(e)},e.prototype._removeLine=function(e){return this.lineData.splice(e,1)},e.prototype.reserveCharacters=function(e){var t;return t=this.getLine(),this.lineData[this.cursorY]=t.slice(0,this.cursorX).concat(" ".times(e).split(""),t.slice(this.cursorX,this.cols-e)),this.updateLine()},e.prototype.fill=function(e,t,n,r,i){var s,o,u;i==null&&(i=this.brush),o=this.getLine(e),s=0,u=[];while(s<n)o[t+s]=[r,i],u.push(s++);return u},e.prototype.deleteCharacters=function(e){var t,n;return n=this.getLine(),t=n[n.length-1][1],n.splice(this.cursorX,e),this.fill(this.cursorY,this.cols-e,e," ",t),this.updateLine()},e.prototype.print=function(e){var t,n,r;e=Utf8.decode(e),r=this.cursorY,n=0;while(n<e.length)this.cursorX>=this.cols&&this.goToNextRowFirstColumn(),this.fill(this.cursorY,this.cursorX,1,this.charsetModifier(e[n])),this.cursorX+=1,n++;return t=this.cursorY,this.updateLines(r,t)},e.prototype.clearLineData=function(e){return this.fill(e,0,this.cols," ")},e.prototype.correctCursorPos=function(){this.cursorX<0&&(this.cursorX=0),this.cursorX>=this.cols&&(this.cursorX=this.cols-1),this.cursorY<0&&(this.cursorY=0);if(this.cursorY>=this.lines)return this.cursorY=this.lines-1},e.prototype.priorRow=function(e){var t,n,r;e==null&&(e=1),r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)this.cursorY>0?(this.cursorY-=1,this.updateLine(this.cursorY),r.push(this.updateLine(this.cursorY+1))):r.push(void 0);return r},e.prototype.nextRow=function(e){var t,n,r;e==null&&(e=1),r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)this.cursorY+1<this.lines?(this.cursorY+=1,this.updateLine(this.cursorY-1),r.push(this.updateLine(this.cursorY))):r.push(void 0);return r},e.prototype.nextColumn=function(e){var t,n,r;e==null&&(e=1),r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)r.push(this._cursorRight());return r},e.prototype.priorColumn=function(e){var t,n,r;e==null&&(e=1),r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)r.push(this._cursorLeft());return r},e.prototype._cursorLeft=function(){if(this.cursorX>0)return this.cursorX-=1,this.updateLine()},e.prototype._cursorRight=function(){if(this.cursorX<this.cols-1)return this.cursorX+=1,this.updateLine()},e.prototype.priorRowFirstColumn=function(e){return e==null&&(e=1),this.goToFirstColumn(),this.priorRow(e)},e.prototype.nextRowFirstColumn=function(e){return e==null&&(e=1),this.goToFirstColumn(),this.nextRow(e)},e.prototype.goToColumn=function(e){return e==null&&(e=1),this.cursorX=e-1,this.correctCursorPos(),this.updateLine()},e.prototype.goToRow=function(e){var t;return e==null&&(e=1),t=this.cursorY,this.cursorY=e-1,this.correctCursorPos(),t!==this.cursorY&&this.updateLine(t),this.updateLine()},e.prototype.goToRowAndColumn=function(e,t){return e==null&&(e=1),t==null&&(t=1),this.goToRow(e),this.goToColumn(t)},e.prototype.goToNextHorizontalTabStop=function(e){var t;return t=this.tabStops.next(this.cursorX),this.goToRowAndColumn(this.cursorY+1,t+1),this.updateLine()},e.prototype.goToPriorHorizontalTabStop=function(e){var t;return t=this.tabStops.prev(this.cursorX),this.goToRowAndColumn(this.cursorY+1,t+1),this.updateLine()},e.prototype.clearHorizontalTabStop=function(){return console.log("clearHorizontalTabStop")},e.prototype.clearAllHorizontalTabStops=function(){return console.log("clearAllHorizontalTabStops")},e.prototype.saveCursor=function(){return this.savedCol=this.cursorX,this.savedLine=this.cursorY},e.prototype.restoreCursor=function(){var e;return e=this.cursorY,this.cursorY=this.savedLine,this.cursorX=this.savedCol,this.updateLine(e),this.updateLine()},e.prototype.goToFirstColumn=function(){return this.cursorX=0,this.updateLine()},e.prototype.setBrush=function(e){return this.brush=e},e.prototype.getBrush=function(){return this.brush},e.prototype.saveBrush=function(){return this.savedBrush=this.brush},e.prototype.restoreBrush=function(){return this.brush=this.savedBrush},e.prototype.repeatLastCharacter=function(e){e==null&&(e=1)},e.prototype.updateBrush=function(e){return this.brush=this.brush.applyChanges(e)},e.prototype.inScrollRegion=function(){return this.cursorY>=this.topMargin()&&this.cursorY<=this.bottomMargin()},e.prototype.scrollUp=function(e){return e==null&&(e=1),this.insertLines(e,this.topMargin())},e.prototype.scrollDown=function(e){return e==null&&(e=1),this.deleteLines(e,this.topMargin())},e.prototype.insertLines=function(e,t){var n;t==null&&(t=this.cursorY);if(!this.inScrollRegion())return;n=0;while(n<e)this._removeLine(this.bottomMargin()),this._addEmptyLine(t),n++;return this.updateLines(t,this.bottomMargin())},e.prototype.deleteLines=function(e,t){var n;t==null&&(t=this.cursorY);if(!this.inScrollRegion())return;n=0;while(n<e)this._removeLine(t),this._addEmptyLine(this.bottomMargin()),n++;return this.updateLines(t,this.bottomMargin())},e.prototype.goToPriorRow=function(){return this.cursorY===this.topMargin()?this.scrollUp():this.priorRow()},e.prototype.goToNextRow=function(){return this.cursorY===this.bottomMargin()?this.scrollDown():this.nextRow()},e.prototype.goToNextRowFirstColumn=function(){return this.goToFirstColumn(),this.goToNextRow()},e.prototype.setLineWrap=function(e){},e.prototype.eraseScreen=function(){var e,t;e=0,t=[];while(e<this.lines)this.clearLineData(e),this.updateLine(e),t.push(e++);return t},e.prototype.eraseFromScreenStart=function(){var e;e=0;while(e<this.cursorY)this.clearLineData(e),this.updateLine(e),e++;return this.eraseFromRowStart()},e.prototype.eraseToScreenEnd=function(){var e,t;this.eraseToRowEnd(),e=this.cursorY+1,t=[];while(e<this.lines)this.clearLineData(e),this.updateLine(e),t.push(e++);return t},e.prototype.eraseRow=function(){return this.fill(this.cursorY,0,this.cols," "),this.updateLine()},e.prototype.eraseFromRowStart=function(){return this.fill(this.cursorY,0,this.cursorX," "),this.updateLine()},e.prototype.eraseToRowEnd=function(){return this.fill(this.cursorY,this.cursorX,this.cols-this.cursorX," "),this.updateLine()},e.prototype.eraseCharacters=function(e){return e==null&&(e=1),this.fill(this.cursorY,this.cursorX,e," "),this.updateLine()},e.prototype.setCharset=function(e){this.charset=e;switch(e){case"uk":return this.charsetModifier=this.ukCharsetModifier;case"us":return this.charsetModifier=this.usCharsetModifier;case"special":return this.charsetModifier=this.specialCharsetModifier}},e.prototype.getCharset=function(){return this.charset},e.prototype.usCharsetModifier=function(e){return e},e.prototype.ukCharsetModifier=function(e){return e},e.prototype.specialCharsetModifier=function(e){return AsciiIo.SpecialCharset[e.charCodeAt(0)]||e},e}()}.call(this),function(){AsciiIo.ScrollRegion=function(){function e(e,t){this.top=e,this.bottom=t}return e.prototype.setTop=function(e){this.top=e},e.prototype.setBottom=function(e){this.bottom=e},e.prototype.getTop=function(){return this.top},e.prototype.getBottom=function(){return this.bottom},e.prototype.save=function(){return this.savedTop=this.top,this.savedBottom=this.bottom},e.prototype.restore=function(){return this.top=this.savedTop,this.bottom=this.savedBottom},e}()}.call(this),function(){AsciiIo.SgrInterpreter=function(){function e(){}return e.prototype.parse=function(e){var t,n,r;t={},n=0;while(n<e.length)r=e[n],r===0?(t.fg=void 0,t.bg=void 0,t.blink=!1,t.bright=!1,t.italic=!1,t.underline=!1,t.reverse=!1):r===1?t.bright=!0:r===3?t.italic=!0:r===4?t.underline=!0
:r===5?t.blink=!0:r===7?t.reverse=!0:r===23?t.italic=!1:r===24?t.underline=!1:r===25?t.blink=!1:r===27?t.reverse=!1:r>=30&&r<=37?t.fg=r-30:r===38?(t.fg=e[n+2],n+=2):r===39?t.fg=void 0:r>=40&&r<=47?t.bg=r-40:r===48?(t.bg=e[n+2],n+=2):r===49?t.bg=void 0:r>=90&&r<=97?t.fg=r-90:r>=100&&r<=107&&(t.bg=r-100),n++;return t},e}()}.call(this),function(){AsciiIo.SpecialCharset={33:"!",34:'"',35:"#",36:"$",37:"%",38:"&",39:"'",40:"(",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",64:"@",65:"↑",66:"↓",67:"→",68:"←",69:"█",70:"▚",71:"☃",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"[",92:"\\",93:"]",94:"^",95:"_",96:"◆",97:"▒",98:"␉",99:"␌",100:"␍",101:"␊",102:"°",103:"±",104:"␤",105:"␋",106:"┘",107:"┐",108:"┌",109:"└",110:"┼",111:"⎺",112:"⎻",113:"─",114:"⎼",115:"⎽",116:"├",117:"┤",118:"┴",119:"┬",120:"│",121:"≤",122:"≥",123:"π",124:"≠",125:"£",126:"·"}}.call(this),function(){AsciiIo.TabStops=function(){function e(e){var t;this.cols=e,this.stops=function(){var e,n,r;r=[];for(t=e=0,n=this.cols;0<=n?e<n:e>n;t=0<=n?++e:--e)t%8===0&&r.push(t);return r}.call(this)}return e.prototype.add=function(e){var t;if(!_(this.stops).include(e))return t=_(this.stops).sortedIndex(e),this.stops.splice(t,0,e)},e.prototype.next=function(e){var t,n,r,i;i=this.stops;for(n=0,r=i.length;n<r;n++){t=i[n];if(t>e)return t}return this.cols},e.prototype.prev=function(e){var t,n,r,i,s;t=0,s=this.stops;for(r=0,i=s.length;r<i;r++){n=s[r];if(n>e)break;t=n}return t},e}()}.call(this),function(){var e=[].slice;AsciiIo.VT=function(){function t(e,t){this.cols=e,this.lines=t,_.extend(this,Backbone.Events),this.interpreter=new AsciiIo.AnsiInterpreter,this.reset()}return t.prototype.feed=function(t){var n,r,i,s,o,u,a;this.data+=t,a=this.interpreter.parse(this.data),i=a[0],this.data=a[1];for(o=0,u=i.length;o<u;o++)r=i[o],s=r[0],n=2<=r.length?e.call(r,1):[],this[s].apply(this,n);return this.data.length===0},t.prototype.reset=function(){return this.data="",this.resetTerminal()},t.prototype.bell=function(){return this.trigger("bell")},t.prototype.state=function(){return{changes:this.buffer.changes(),cursorX:this.buffer.cursorX,cursorY:this.buffer.cursorY}},t.prototype.clearChanges=function(){return this.buffer.clearChanges()},t.prototype.switchToNormalBuffer=function(){return this.buffer=this.normalBuffer,this.updateScreen()},t.prototype.switchToAlternateBuffer=function(){return this.alternateBuffer.setBrush(this.normalBuffer.getBrush()),this.alternateBuffer.setCharset(this.normalBuffer.getCharset()),this.buffer=this.alternateBuffer,this.updateScreen()},t.prototype.updateScreen=function(){return this.buffer.updateScreen()},t.prototype.carriageReturn=function(){return this.buffer.goToFirstColumn()},t.prototype.backspace=function(){return this.buffer.priorColumn()},t.prototype.showCursor=function(){return this.trigger("cursor-visibility",!0)},t.prototype.hideCursor=function(){return this.trigger("cursor-visibility",!1)},t.prototype.reverseIndex=function(){return this.buffer.goToPriorRow()},t.prototype.lineFeed=function(){return this.buffer.goToNextRow()},t.prototype.verticalTab=function(){return this.buffer.goToNextRow()},t.prototype.formFeed=function(){return this.buffer.goToNextRow()},t.prototype.index=function(){return this.buffer.goToNextRow()},t.prototype.newLine=function(){return this.buffer.goToNextRowFirstColumn()},t.prototype.setScrollRegion=function(e,t){e<1&&(e=1),t>this.lines&&(t=this.lines);if(t>e)return this.scrollRegion.setTop(e-1),this.scrollRegion.setBottom(t-1)},t.prototype.setHorizontalTabStop=function(){return this.tabStops.add(this.cursorX)},t.prototype.resetTerminal=function(){return this.scrollRegion=new AsciiIo.ScrollRegion(0,this.lines-1),this.tabStops=new AsciiIo.TabStops(this.cols),this.normalBuffer=new AsciiIo.ScreenBuffer(this.cols,this.lines,this.scrollRegion,this.tabStops),this.alternateBuffer=new AsciiIo.ScreenBuffer(this.cols,this.lines,this.scrollRegion,this.tabStops),this.buffer=this.normalBuffer,this.fg=this.bg=void 0,this.bright=!1,this.underline=!1,this.italic=!1,this.updateScreen()},t.prototype.saveTerminalState=function(){return this.buffer.saveCursor(),this.scrollRegion.save(),this.buffer.saveBrush()},t.prototype.restoreTerminalState=function(){return this.buffer.restoreBrush(),this.scrollRegion.restore(),this.buffer.restoreCursor()},t.prototype.reportRowAndColumn=function(){},t.prototype.setUkCharset=function(){return this.buffer.setCharset("utf-8")},t.prototype.setUsCharset=function(){return this.buffer.setCharset("utf-8")},t.prototype.setSpecialCharset=function(){return this.buffer.setCharset("utf-8")},t.prototype.print=function(e){return this.buffer.print(e)},t.prototype.reserveCharacters=function(e){return this.buffer.reserveCharacters(e)},t.prototype.priorRow=function(e){return this.buffer.priorRow(e)},t.prototype.nextRow=function(e){return this.buffer.nextRow(e)},t.prototype.nextColumn=function(e){return this.buffer.nextColumn(e)},t.prototype.priorColumn=function(e){return this.buffer.priorColumn(e)},t.prototype.nextRowFirstColumn=function(e){return this.buffer.nextRowFirstColumn(e)},t.prototype.priorRowFirstColumn=function(e){return this.buffer.priorRowFirstColumn(e)},t.prototype.goToColumn=function(e){return this.buffer.goToColumn(e)},t.prototype.goToRowAndColumn=function(e,t){return this.buffer.goToRowAndColumn(e,t)},t.prototype.goToNextHorizontalTabStop=function(e){return e==null&&(e=1),this.buffer.goToNextHorizontalTabStop(e)},t.prototype.eraseScreen=function(){return this.buffer.eraseScreen()},t.prototype.eraseFromScreenStart=function(){return this.buffer.eraseFromScreenStart()},t.prototype.eraseToScreenEnd=function(){return this.buffer.eraseToScreenEnd()},t.prototype.eraseRow=function(){return this.buffer.eraseRow()},t.prototype.eraseFromRowStart=function(){return this.buffer.eraseFromRowStart()},t.prototype.eraseToRowEnd=function(){return this.buffer.eraseToRowEnd()},t.prototype.insertLines=function(e){return this.buffer.insertLines(e)},t.prototype.deleteLines=function(e){return this.buffer.deleteLines(e)},t.prototype.deleteCharacters=function(e){return this.buffer.deleteCharacters(e)},t.prototype.scrollUp=function(e){return this.buffer.scrollUp(e)},t.prototype.scrollDown=function(e){return this.buffer.scrollDown(e)},t.prototype.eraseCharacters=function(e){return this.buffer.eraseCharacters(e)},t.prototype.goToPriorHorizontalTabStop=function(e){return this.buffer.goToPriorHorizontalTabStop(e)},t.prototype.repeatLastCharacter=function(e){return this.buffer.repeatLastCharacter(e)},t.prototype.goToRow=function(e){return this.buffer.goToRow(e)},t.prototype.clearHorizontalTabStop=function(){return this.buffer.clearHorizontalTabStop()},t.prototype.clearAllHorizontalTabStops=function(){return this.buffer.clearAllHorizontalTabStops()},t.prototype.updateBrush=function(e){return this.buffer.updateBrush(e)},t}()}.call(this),function(){var e=[].slice;AsciiIo.Movie=function(){function t(e){this.options=e,_.extend(this,Backbone.Events),this.reset(),this.startTimeReporter()}return t.prototype.MIN_DELAY=.01,t.prototype.reset=function(){return this.frameNo=0,this.dataIndex=0,this.completedFramesTime=0,this.playing=!1,this.lastFrameAt=void 0,this.framesProcessed=0,this.clearPauseState(),this.trigger("reset")},t.prototype.call=function(){var t,n;return n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],this[n].apply(this,t)},t.prototype.now=function(){return(new Date).getTime()},t.prototype.timing=function(){return this.options.timing},t.prototype.mp3=function(){return this.options.mp3},t.prototype.data=function(){return this.options.stdout_data},t.prototype.play=function(){if(this.isPlaying())return;return this.isFinished()?this.restart():this.isPaused()?this.resume():this.start()},t.prototype.start=function(){return this.playing=!0,this.trigger("started"),this.lastFrameAt=this.now(),this.nextFrame()},t.prototype.stop=function(){var e;return this.playing=!1,this.cancelNextFrameProcessing(),e=this.now(),this.adjustFrameWaitTime(e),this.pausedAt=e},t.prototype.cancelNextFrameProcessing=function(){return clearInterval(this.nextFrameTimeoutId)},t.prototype.adjustFrameWaitTime=function(e){var t,n;return n=this.resumedAt||this.lastFrameAt,t=e-n,this.totalFrameWaitTime+=t},t.prototype.restart=function(){return this.reset(),this.start()},t.prototype.pause=function(){if(this.isPaused())return;return this.stop(),this.trigger("paused")},t.prototype.resume=function(){var e,t,n,r,i;if(this.isPlaying())return;return this.playing=!0,this.resumedAt=this.now(),i=this.timing()[this.frameNo],t=i[0],e=i[1],r=t*1e3,n=r-this.totalFrameWaitTime,this.processFrameWithDelay(n),this.trigger("resumed")},t.prototype.togglePlay=function(){return this.isPlaying()?this.pause():this.play()},t.prototype.isPlaying=function(){return this.playing},t.prototype.isPaused=function(){return!this.isPlaying()&&!this.isFinished()&&this.frameNo>0},t.prototype.isFinished=function(){return!this.isPlaying()&&this.frameNo>=this.timing().length},t.prototype.seek=function(e){return this.stop(),this.rewindTo(e),this.resume()},t.prototype.rewindTo=function(e){var t,n,r,i,s,o,u,a,f,l;i=this.options.duration,o=i*e/100,s=0,u=0,a=0,r=void 0,t=void 0;while(u<o)l=this.timing()[s],r=l[0],t=l[1],u+=r,a+=t,s+=1;return this.frameNo=s,this.completedFramesTime=u*1e3,this.dataIndex=a,n=this.data().slice(0,a),this.trigger("reset"),this.trigger("data",[n]),this.lastFrameAt=this.now(),f=o-u,this.totalFrameWaitTime=f*1e3},t.prototype.startTimeReporter=function(){var e=this;return this.timeReportId=setInterval(function(){return e.trigger("time",e.currentTime())},500)},t.prototype.stopTimeReporter=function(){return clearInterval(this.timeReportId)},t.prototype.currentTime=function(){return this.completedFramesTime+this.currentFrameTime()},t.prototype.currentFrameTime=function(){return this.isPlaying()?this.playingFrameTime():this.isPaused()?this.pausedFrameTime():0},t.prototype.playingFrameTime=function(){return this.frameWasPaused()?this.currentFrameWithPauseTime():this.currentFrameWithNoPauseTime()},t.prototype.frameWasPaused=function(){return!!this.pausedAt},t.prototype.currentFrameWithPauseTime=function(){return this.totalFrameWaitTime+this.sinceResumeTime()},t.prototype.currentFrameWithNoPauseTime=function(){return this.now()-this.lastFrameAt},t.prototype.sinceResumeTime=function(){return this.now()-this.resumedAt},t.prototype.pausedFrameTime=function(){return this.totalFrameWaitTime},t.prototype.clearPauseState=function(){return this.pausedAt=void 0,this.resumedAt=void 0,this.totalFrameWaitTime=0},t.prototype.nextFrame=function(){var e,t,n,r;return(n=this.timing()[this.frameNo])?(t=n[0],e=n[1],this.framesProcessed=0,r=t*1e3*(1/this.options.speed),this.processFrameWithDelay(r),!0):(this.playing=!1,this.trigger("finished"),!1)},t.prototype.processFrameWithDelay=function(e){var t=this;return this.nextFrameTimeoutId=setTimeout(function(){return t.trigger("wakeup"),t.processFrame()},e)},t.prototype.processFrame=function(){var e,t,n,r;return n=this.timing()[this.frameNo],t=n[0],e=n[1],r=this.data().slice(this.dataIndex,this.dataIndex+e),this.trigger("data",[r]),this.frameNo+=1,this.dataIndex+=e,this.completedFramesTime+=t*1e3,this.lastFrameAt=this.now(),this.clearPauseState(),this.nextFrame()},t}()}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};AsciiIo.Player=function(e){function n(e){this.options=e,this.createWorkerProxy(),n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.createWorkerProxy=function(){return this.workerProxy=new AsciiIo.WorkerProxy(window.mainWorkerPath)},n.prototype.createVT=function(){return this.vt=this.workerProxy.getObjectProxy("vt")},n.prototype.createMovie=function(){return this.movie=this.workerProxy.getObjectProxy("movie")},n.prototype.onModelReady=function(){return this.initWorkerProxy(),n.__super__.onModelReady.apply(this,arguments)},n.prototype.initWorkerProxy=function(){return this.workerProxy.init(this.movieOptions())},n}(AsciiIo.AbstractPlayer)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};AsciiIo.FallbackPlayer=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.createVT=function(){return this.vt=new AsciiIo.VT(this.options.cols,this.options.lines)},n.prototype.createMovie=function(){return this.movie=new AsciiIo.Movie(this.movieOptions())},n.prototype.onModelReady=function(){return n.__super__.onModelReady.apply(this,arguments)},n.prototype.bindEvents=function(){var e=this;return n.__super__.bindEvents.apply(this,arguments),this.movie.on("reset",function(){return e.vt.reset()}),this.movie.on("data",function(t){var n;return e.vt.feed(t),n=e.vt.state(),e.vt.clearChanges(),e.movie.trigger("render",n)})},n}(AsciiIo.AbstractPlayer)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};AsciiIo.PlayerView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.events={"click .start-prompt":"onStartPromptClick"},n.prototype.initialize=function(e){return this.createRendererView(),e.hud&&this.createHudView(),this.showLoadingOverlay()},n.prototype.createRendererView=function(){return this.rendererView=new this.options.rendererClass({cols:this.options.cols,lines:this.options.lines}),this.$el.append(this.rendererView.$el),this.rendererView.afterInsertedToDom(),this.rendererView.renderSnapshot(this.options.snapshot)},n.prototype.createHudView=function(){var e=this;return this.hudView=new AsciiIo.HudView({cols:this.options.cols}),this.hudView.on("play-click",function(){return e.onPlayClicked()}),this.hudView.on("seek-click",function(t){return e.onSeekClicked(t)}),this.$el.append(this.hudView.$el)},n.prototype.onModelReady=function(){this.hideLoadingOverlay();if(this.hudView)return this.hudView.setDuration(this.model.get("duration"))},n.prototype.onStartPromptClick=function(){return this.hidePlayOverlay(),this.onPlayClicked()},n.prototype.onPlayClicked=function(){var e,t,n;return e='<embed width="1" height="1" autostart="true" loop="true" src="',t='">',n=this.model.get("mp3").url,this.$el.append(e+n+t),this.trigger("play-clicked")},n.prototype.onSeekClicked=function(e){return this.trigger("seek-clicked",e)},n.prototype.showLoadingOverlay=function(){return this.$el.append('<div class="loading">')},n.prototype.hideLoadingOverlay=function(){return this.$(".loading").remove()},n.prototype.showPlayOverlay=function(){return this.$el.append('<div class="start-prompt"><div class="play-button"><div class="arrow">►</div></div></div>')},n.prototype.hidePlayOverlay=function(){return this.$(".start-prompt").remove()},n.prototype.onStateChanged=function(e){this.$el.removeClass("playing paused");switch(e){case"playing":return this.$el.addClass("playing");case"finished":return this.rendererView.stopCursorBlink();case"paused":this.$el.addClass("paused");if(this.hudView)return this.hudView.onPause();break;case"resumed":this.$el.addClass("playing");if(this.hudView)return this.hudView.onResume()}},n.prototype.renderState=function(e){return this.rendererView.push(e)},n.prototype.updateTime=function(e){if(this.hudView)return this.hudView.updateTime(e)},n.prototype.restartCursorBlink=function(){return this.rendererView.restartCursorBlink()},n.prototype.showCursor=function(e){return this.rendererView.showCursor(e)},n}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].slice;AsciiIo.WorkerObjectProxy=function(){function n(t,n){this.webWorker=t,this.objectName=n,this.onMessage=e(this.onMessage,this),_.extend(this,Backbone.Events),this.webWorker.addEventListener("message",this.onMessage)}return n.prototype.onMessage=function(e){if(e.data.evt&&e.data.src===this.objectName)return this.trigger.apply(this,[e.data.evt].concat(t.call(e.data.args)))},n.prototype.call=function(){var e,n;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],this.webWorker.postMessage({message:"call",objectName:this.objectName,method:n,args:e})},n}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};AsciiIo.WorkerProxy=function(){function t(t){this.onMessage=e(this.onMessage,this),this.webWorker=new window.Worker(t),this.webWorker.addEventListener("message",this.onMessage)}return t.prototype.init=function(e){return this.webWorker.postMessage({message:"init",options:e})},t.prototype.getObjectProxy=function(e){return new AsciiIo.WorkerObjectProxy(this.webWorker,e)},t.prototype.onMessage=function(e){if(e.data.message==="log")return console.log(e.data.text)},t}()}.call(this),function(){AsciiIo.Brush=function(){function e(e){var t,n;e==null&&(e={}),this.fg=void 0,this.bg=void 0,this.blink=!1,this.bright=!1,this.italic=!1,this.underline=!1,this.reverse=!1;for(t in e)n=e[t],this[t]=n}return e.default_fg=7,e.default_bg=0,e.cache={},e.clearCache=function(){return this.cache={}},e["default"]=function(){return this._default||(this._default=this.create())},e.hash=function(e){return""+e.fg+"_"+e.bg+"_"+e.blink+"_"+e.bright+"_"+e.italic+"_"+e.underline+"_"+e.reverse},e.create=function(e){var t,n;return e==null&&(e={}),n=this.hash(e),t=this.cache[n],t||(t=new AsciiIo.Brush(e),this.cache[n]=t),t},e.prototype.hash=function(){return AsciiIo.Brush.hash(this)},e.prototype.attributes=function(){return{fg:this.fg,bg:this.bg,blink:this.blink,bright:this.bright,italic:this.italic,underline:this.underline,reverse:this.reverse}},e.prototype.fgColor=function(){return this.reverse?this.calculateBgColor():this.calculateFgColor()},e.prototype.bgColor=function(){return this.reverse?this.calculateFgColor():this.calculateBgColor()},e.prototype.calculateFgColor=function(){var e;return e=this.fg,e===void 0&&(e=AsciiIo.Brush.default_fg),e<8&&this.bright&&(e+=8),e},e.prototype.calculateBgColor=function(){var e;return e=this.bg,e===void 0&&(e=AsciiIo.Brush.default_bg),e<8&&this.blink&&(e+=8),e},e.prototype.applyChanges=function(e){var t,n,r;n=this.attributes();for(t in e)r=e[t],n[t]=r;return AsciiIo.Brush.create(n)},e.prototype.hasDefaultFg=function(){return this.fgColor()===AsciiIo.Brush.default_fg},e.prototype.hasDefaultBg=function(){return this.bgColor()===AsciiIo.Brush.default_bg},e}()}.call(this),AsciiIo.colors={0:"#000000",1:"#CC0000",2:"#4E9A06",3:"#C4A000",4:"#3465A4",5:"#75507B",6:"#06989A",7:"#D3D7CF",8:"#555753",9:"#EF2929",10:"#8AE234",11:"#FCE94F",12:"#729FCF",13:"#AD7FA8",14:"#34E2E2",15:"#EEEEEC",16:"#000000",17:"#00005f",18:"#000087",19:"#0000af",20:"#0000d7",21:"#0000ff",22:"#005f00",23:"#005f5f",24:"#005f87",25:"#005faf",26:"#005fd7",27:"#005fff",28:"#008700",29:"#00875f",30:"#008787",31:"#0087af",32:"#0087d7",33:"#0087ff",34:"#00af00",35:"#00af5f",36:"#00af87",37:"#00afaf",38:"#00afd7",39:"#00afff",40:"#00d700",41:"#00d75f",42:"#00d787",43:"#00d7af",44:"#00d7d7",45:"#00d7ff",46:"#00ff00",47:"#00ff5f",48:"#00ff87",49:"#00ffaf",50:"#00ffd7",51:"#00ffff",52:"#5f0000",53:"#5f005f",54:"#5f0087",55:"#5f00af",56:"#5f00d7",57:"#5f00ff",58:"#5f5f00",59:"#5f5f5f",60:"#5f5f87",61:"#5f5faf",62:"#5f5fd7",63:"#5f5fff",64:"#5f8700",65:"#5f875f",66:"#5f8787",67:"#5f87af",68:"#5f87d7",69:"#5f87ff",70:"#5faf00",71:"#5faf5f",72:"#5faf87",73:"#5fafaf",74:"#5fafd7",75:"#5fafff",76:"#5fd700",77:"#5fd75f",78:"#5fd787",79:"#5fd7af",80:"#5fd7d7",81:"#5fd7ff",82:"#5fff00",83:"#5fff5f",84:"#5fff87",85:"#5fffaf",86:"#5fffd7",87:"#5fffff",88:"#870000",89:"#87005f",90:"#870087",91:"#8700af",92:"#8700d7",93:"#8700ff",94:"#875f00",95:"#875f5f",96:"#875f87",97:"#875faf",98:"#875fd7",99:"#875fff",100:"#878700",101:"#87875f",102:"#878787",103:"#8787af",104:"#8787d7",105:"#8787ff",106:"#87af00",107:"#87af5f",108:"#87af87",109:"#87afaf",110:"#87afd7",111:"#87afff",112:"#87d700",113:"#87d75f",114:"#87d787",115:"#87d7af",116:"#87d7d7",117:"#87d7ff",118:"#87ff00",119:"#87ff5f",120:"#87ff87",121:"#87ffaf",122:"#87ffd7",123:"#87ffff",124:"#af0000",125:"#af005f",126:"#af0087",127:"#af00af",128:"#af00d7",129:"#af00ff",130:"#af5f00",131:"#af5f5f",132:"#af5f87",133:"#af5faf",134:"#af5fd7",135:"#af5fff",136:"#af8700",137:"#af875f",138:"#af8787",139:"#af87af",140:"#af87d7",141:"#af87ff",142:"#afaf00",143:"#afaf5f",144:"#afaf87",145:"#afafaf",146:"#afafd7",147:"#afafff",148:"#afd700",149:"#afd75f",150:"#afd787",151:"#afd7af",152:"#afd7d7",153:"#afd7ff",154:"#afff00",155:"#afff5f",156:"#afff87",157:"#afffaf",158:"#afffd7",159:"#afffff",160:"#d70000",161:"#d7005f",162:"#d70087",163:"#d700af",164:"#d700d7",165:"#d700ff",166:"#d75f00",167:"#d75f5f",168:"#d75f87",169:"#d75faf",170:"#d75fd7",171:"#d75fff",172:"#d78700",173:"#d7875f",174:"#d78787",175:"#d787af",176:"#d787d7",177:"#d787ff",178:"#d7af00",179:"#d7af5f",180:"#d7af87",181:"#d7afaf",182:"#d7afd7",183:"#d7afff",184:"#d7d700",185:"#d7d75f",186:"#d7d787",187:"#d7d7af",188:"#d7d7d7",189:"#d7d7ff",190:"#d7ff00",191:"#d7ff5f",192:"#d7ff87",193:"#d7ffaf",194:"#d7ffd7",195:"#d7ffff",196:"#ff0000",197:"#ff005f",198:"#ff0087",199:"#ff00af",200:"#ff00d7",201:"#ff00ff",202:"#ff5f00",203:"#ff5f5f",204:"#ff5f87",205:"#ff5faf",206:"#ff5fd7",207:"#ff5fff",208:"#ff8700",209:"#ff875f",210:"#ff8787",211:"#ff87af",212:"#ff87d7",213:"#ff87ff",214:"#ffaf00",215:"#ffaf5f",216:"#ffaf87",217:"#ffafaf",218:"#ffafd7",219:"#ffafff",220:"#ffd700",221:"#ffd75f",222:"#ffd787",223:"#ffd7af",224:"#ffd7d7",225:"#ffd7ff",226:"#ffff00",227:"#ffff5f",228:"#ffff87",229:"#ffffaf",230:"#ffffd7",231:"#ffffff",232:"#080808",233:"#121212",234:"#1c1c1c",235:"#262626",236:"#303030",237:"#3a3a3a",238:"#444444",239:"#4e4e4e",240:"#585858",241:"#626262",242:"#6c6c6c",243:"#767676",244:"#808080",245:"#8a8a8a",246:"#949494",247:"#9e9e9e",248:"#a8a8a8",249:"#b2b2b2",250:"#bcbcbc",251:"#c6c6c6",252:"#d0d0d0",253:"#dadada",254:"#e4e4e4",255:"#eeeeee"},function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};AsciiIo.Asciicast=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.url=function(){return"/a/"+this.get("id")+".json"},n}(Backbone.Model)}.call(this);